"use strict";

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.promise");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.waitUntil = waitUntil;
exports.TimeoutError = void 0;

class TimeoutError extends Error {}

exports.TimeoutError = TimeoutError;

function timeoutPromise(ms, promise, description) {
  const timeout = new Promise((_, reject) => {
    const id = setTimeout(() => {
      clearTimeout(id);
      const error = new TimeoutError(description);
      reject(error);
    }, ms);
  });
  return Promise.race([promise, timeout]);
}

function waitUntil(asyncTest, description = '', timeout = 10000, interval = 100) {
  const promise = new Promise((resolve, reject) => {
    function wait() {
      asyncTest().then(value => {
        if (value === true) {
          resolve();
        } else {
          setTimeout(wait, interval);
        }
      }).catch(() => {
        reject();
      });
    }

    wait();
  });
  return timeoutPromise(timeout, promise, description);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL3dhaXRpbmcudHMiXSwibmFtZXMiOlsiVGltZW91dEVycm9yIiwiRXJyb3IiLCJ0aW1lb3V0UHJvbWlzZSIsIm1zIiwicHJvbWlzZSIsImRlc2NyaXB0aW9uIiwidGltZW91dCIsIlByb21pc2UiLCJfIiwicmVqZWN0IiwiaWQiLCJzZXRUaW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwiZXJyb3IiLCJyYWNlIiwid2FpdFVudGlsIiwiYXN5bmNUZXN0IiwiaW50ZXJ2YWwiLCJyZXNvbHZlIiwid2FpdCIsInRoZW4iLCJ2YWx1ZSIsImNhdGNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFDTyxNQUFNQSxZQUFOLFNBQTJCQyxLQUEzQixDQUFpQzs7OztBQUd4QyxTQUFTQyxjQUFULENBQXdCQyxFQUF4QixFQUFvQ0MsT0FBcEMsRUFBMkRDLFdBQTNELEVBQWdGO0FBQzlFLFFBQU1DLE9BQU8sR0FBRyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsQ0FBRCxFQUFJQyxNQUFKLEtBQWU7QUFDekMsVUFBTUMsRUFBRSxHQUFHQyxVQUFVLENBQUMsTUFBTTtBQUMxQkMsTUFBQUEsWUFBWSxDQUFDRixFQUFELENBQVo7QUFDQSxZQUFNRyxLQUFLLEdBQUcsSUFBSWIsWUFBSixDQUFpQkssV0FBakIsQ0FBZDtBQUNBSSxNQUFBQSxNQUFNLENBQUNJLEtBQUQsQ0FBTjtBQUNELEtBSm9CLEVBSWxCVixFQUprQixDQUFyQjtBQUtELEdBTmUsQ0FBaEI7QUFRQSxTQUFPSSxPQUFPLENBQUNPLElBQVIsQ0FBYSxDQUNsQlYsT0FEa0IsRUFFbEJFLE9BRmtCLENBQWIsQ0FBUDtBQUlEOztBQUVNLFNBQVNTLFNBQVQsQ0FBbUJDLFNBQW5CLEVBQWtEWCxXQUFXLEdBQUcsRUFBaEUsRUFBb0VDLE9BQU8sR0FBRyxLQUE5RSxFQUFxRlcsUUFBUSxHQUFHLEdBQWhHLEVBQXFHO0FBQzFHLFFBQU1iLE9BQU8sR0FBRyxJQUFJRyxPQUFKLENBQVksQ0FBQ1csT0FBRCxFQUFVVCxNQUFWLEtBQXFCO0FBQy9DLGFBQVNVLElBQVQsR0FBZ0I7QUFDZEgsTUFBQUEsU0FBUyxHQUFHSSxJQUFaLENBQWtCQyxLQUFELElBQVc7QUFDMUIsWUFBSUEsS0FBSyxLQUFLLElBQWQsRUFBb0I7QUFDbEJILFVBQUFBLE9BQU87QUFDUixTQUZELE1BRU87QUFDTFAsVUFBQUEsVUFBVSxDQUFDUSxJQUFELEVBQU9GLFFBQVAsQ0FBVjtBQUNEO0FBQ0YsT0FORCxFQU1HSyxLQU5ILENBTVMsTUFBTTtBQUNiYixRQUFBQSxNQUFNO0FBQ1AsT0FSRDtBQVNEOztBQUNEVSxJQUFBQSxJQUFJO0FBQ0wsR0FiZSxDQUFoQjtBQWNBLFNBQU9qQixjQUFjLENBQUNJLE9BQUQsRUFBVUYsT0FBVixFQUFtQkMsV0FBbkIsQ0FBckI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGNsYXNzIFRpbWVvdXRFcnJvciBleHRlbmRzIEVycm9yIHtcblxufVxuZnVuY3Rpb24gdGltZW91dFByb21pc2UobXM6IG51bWJlciwgcHJvbWlzZTogUHJvbWlzZTxhbnk+LCBkZXNjcmlwdGlvbjogc3RyaW5nKSB7XG4gIGNvbnN0IHRpbWVvdXQgPSBuZXcgUHJvbWlzZSgoXywgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgaWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNsZWFyVGltZW91dChpZCk7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBUaW1lb3V0RXJyb3IoZGVzY3JpcHRpb24pO1xuICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICB9LCBtcyk7XG4gIH0pO1xuXG4gIHJldHVybiBQcm9taXNlLnJhY2UoW1xuICAgIHByb21pc2UsXG4gICAgdGltZW91dCxcbiAgXSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3YWl0VW50aWwoYXN5bmNUZXN0OiAoKSA9PiBQcm9taXNlPGFueT4sIGRlc2NyaXB0aW9uID0gJycsIHRpbWVvdXQgPSAxMDAwMCwgaW50ZXJ2YWwgPSAxMDApIHtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBmdW5jdGlvbiB3YWl0KCkge1xuICAgICAgYXN5bmNUZXN0KCkudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldFRpbWVvdXQod2FpdCwgaW50ZXJ2YWwpO1xuICAgICAgICB9XG4gICAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgIHJlamVjdCgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHdhaXQoKTtcbiAgfSk7XG4gIHJldHVybiB0aW1lb3V0UHJvbWlzZSh0aW1lb3V0LCBwcm9taXNlLCBkZXNjcmlwdGlvbik7XG59XG4iXX0=