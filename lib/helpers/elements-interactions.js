"use strict";

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.promise");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.waitUntilElementFound = waitUntilElementFound;
exports.waitUntilElementDisappear = waitUntilElementDisappear;
exports.waitUntilIframeFound = waitUntilIframeFound;
exports.fillInput = fillInput;
exports.clickButton = clickButton;
exports.clickLink = clickLink;
exports.dropdownSelect = dropdownSelect;
exports.dropdownElements = dropdownElements;
exports.pageEval = pageEval;
exports.pageEvalAll = pageEvalAll;
exports.elementPresentOnPage = elementPresentOnPage;
exports.setValue = setValue;

var _waiting = require("./waiting");

async function waitUntilElementFound(page, elementSelector, onlyVisible = false, timeout = 30000) {
  await page.waitForSelector(elementSelector, {
    visible: onlyVisible,
    timeout
  });
}

async function waitUntilElementDisappear(page, elementSelector, timeout = 30000) {
  await page.waitForSelector(elementSelector, {
    hidden: true,
    timeout
  });
}

async function waitUntilIframeFound(page, framePredicate, description = '', timeout = 30000) {
  let frame;
  await (0, _waiting.waitUntil)(() => {
    frame = page.frames().find(framePredicate);
    return Promise.resolve(!!frame);
  }, description, timeout, 1000);

  if (!frame) {
    throw new Error('failed to find iframe');
  }

  return frame;
}

async function fillInput(pageOrFrame, inputSelector, inputValue) {
  await pageOrFrame.$eval(inputSelector, input => {
    const inputElement = input; // @ts-ignore

    inputElement.value = '';
  });
  await pageOrFrame.type(inputSelector, inputValue);
}

async function setValue(pageOrFrame, inputSelector, inputValue) {
  await pageOrFrame.$eval(inputSelector, (input, inputValue) => {
    const inputElement = input; // @ts-ignore

    inputElement.value = inputValue;
  }, [inputValue]);
}

async function clickButton(page, buttonSelector) {
  await page.$eval(buttonSelector, el => el.click());
}

async function clickLink(page, aSelector) {
  await page.$eval(aSelector, el => {
    if (!el || typeof el.click === 'undefined') {
      return;
    }

    el.click();
  });
}

async function pageEvalAll(page, selector, defaultResult, callback, ...args) {
  let result = defaultResult;

  try {
    result = await page.$$eval(selector, callback, ...args);
  } catch (e) {
    // TODO temporary workaround to puppeteer@1.5.0 which breaks $$eval bevahvior until they will release a new version.
    if (e.message.indexOf('Error: failed to find elements matching selector') !== 0) {
      throw e;
    }
  }

  return result;
}

async function pageEval(pageOrFrame, selector, defaultResult, callback, ...args) {
  let result = defaultResult;

  try {
    result = await pageOrFrame.$eval(selector, callback, ...args);
  } catch (e) {
    // TODO temporary workaround to puppeteer@1.5.0 which breaks $$eval bevahvior until they will release a new version.
    if (e.message.indexOf('Error: failed to find elements matching selector') !== 0) {
      throw e;
    }
  }

  return result;
}

async function elementPresentOnPage(pageOrFrame, selector) {
  return (await pageOrFrame.$(selector)) !== null;
}

async function dropdownSelect(page, selectSelector, value) {
  await page.select(selectSelector, value);
}

async function dropdownElements(page, selector) {
  const options = await page.evaluate(optionSelector => {
    return Array.from(document.querySelectorAll(optionSelector)).filter(o => o.value).map(o => {
      return {
        name: o.text,
        value: o.value
      };
    });
  }, `${selector} > option`);
  return options;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2VsZW1lbnRzLWludGVyYWN0aW9ucy50cyJdLCJuYW1lcyI6WyJ3YWl0VW50aWxFbGVtZW50Rm91bmQiLCJwYWdlIiwiZWxlbWVudFNlbGVjdG9yIiwib25seVZpc2libGUiLCJ0aW1lb3V0Iiwid2FpdEZvclNlbGVjdG9yIiwidmlzaWJsZSIsIndhaXRVbnRpbEVsZW1lbnREaXNhcHBlYXIiLCJoaWRkZW4iLCJ3YWl0VW50aWxJZnJhbWVGb3VuZCIsImZyYW1lUHJlZGljYXRlIiwiZGVzY3JpcHRpb24iLCJmcmFtZSIsImZyYW1lcyIsImZpbmQiLCJQcm9taXNlIiwicmVzb2x2ZSIsIkVycm9yIiwiZmlsbElucHV0IiwicGFnZU9yRnJhbWUiLCJpbnB1dFNlbGVjdG9yIiwiaW5wdXRWYWx1ZSIsIiRldmFsIiwiaW5wdXQiLCJpbnB1dEVsZW1lbnQiLCJ2YWx1ZSIsInR5cGUiLCJzZXRWYWx1ZSIsImNsaWNrQnV0dG9uIiwiYnV0dG9uU2VsZWN0b3IiLCJlbCIsImNsaWNrIiwiY2xpY2tMaW5rIiwiYVNlbGVjdG9yIiwicGFnZUV2YWxBbGwiLCJzZWxlY3RvciIsImRlZmF1bHRSZXN1bHQiLCJjYWxsYmFjayIsImFyZ3MiLCJyZXN1bHQiLCIkJGV2YWwiLCJlIiwibWVzc2FnZSIsImluZGV4T2YiLCJwYWdlRXZhbCIsImVsZW1lbnRQcmVzZW50T25QYWdlIiwiJCIsImRyb3Bkb3duU2VsZWN0Iiwic2VsZWN0U2VsZWN0b3IiLCJzZWxlY3QiLCJkcm9wZG93bkVsZW1lbnRzIiwib3B0aW9ucyIsImV2YWx1YXRlIiwib3B0aW9uU2VsZWN0b3IiLCJBcnJheSIsImZyb20iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmaWx0ZXIiLCJvIiwibWFwIiwibmFtZSIsInRleHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTs7QUFFQSxlQUFlQSxxQkFBZixDQUFxQ0MsSUFBckMsRUFBeURDLGVB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akQsSUFBaEMsRUFBNENrQyxRQUE1QyxFQUE4RDtBQUM1RCxRQUFNZ0IsT0FBTyxHQUFHLE1BQU1sRCxJQUFJLENBQUNtRCxRQUFMLENBQWVDLGNBQUQsSUFBb0I7QUFDdEQsV0FBT0MsS0FBSyxDQUFDQyxJQUFOLENBQVdDLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEJKLGNBQTFCLENBQVgsRUFDSkssTUFESSxDQUNJQyxDQUFELElBQU9BLENBQUMsQ0FBQ2xDLEtBRFosRUFFSm1DLEdBRkksQ0FFQ0QsQ0FBRCxJQUFPO0FBQ1YsYUFBTztBQUNMRSxRQUFBQSxJQUFJLEVBQUVGLENBQUMsQ0FBQ0csSUFESDtBQUVMckMsUUFBQUEsS0FBSyxFQUFFa0MsQ0FBQyxDQUFDbEM7QUFGSixPQUFQO0FBSUQsS0FQSSxDQUFQO0FBUUQsR0FUcUIsRUFTbEIsR0FBRVUsUUFBUyxXQVRPLENBQXRCO0FBVUEsU0FBT2dCLE9BQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZyYW1lLCBQYWdlIH0gZnJvbSAncHVwcGV0ZWVyJztcbmltcG9ydCB7IHdhaXRVbnRpbCB9IGZyb20gJy4vd2FpdGluZyc7XG5cbmFzeW5jIGZ1bmN0aW9uIHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlOiBQYWdlIHwgRnJhbWUsIGVsZW1lbnRTZWxlY3Rvcjogc3RyaW5nLFxuICBvbmx5VmlzaWJsZSA9IGZhbHNlLCB0aW1lb3V0ID0gMzAwMDApIHtcbiAgYXdhaXQgcGFnZS53YWl0Rm9yU2VsZWN0b3IoZWxlbWVudFNlbGVjdG9yLCB7IHZpc2libGU6IG9ubHlWaXNpYmxlLCB0aW1lb3V0IH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiB3YWl0VW50aWxFbGVtZW50RGlzYXBwZWFyKHBhZ2U6IFBhZ2UsIGVsZW1lbnRTZWxlY3Rvcjogc3RyaW5nLCB0aW1lb3V0ID0gMzAwMDApIHtcbiAgYXdhaXQgcGFnZS53YWl0Rm9yU2VsZWN0b3IoZWxlbWVudFNlbGVjdG9yLCB7IGhpZGRlbjogdHJ1ZSwgdGltZW91dCB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2FpdFVudGlsSWZyYW1lRm91bmQocGFnZTogUGFnZSwgZnJhbWVQcmVkaWNhdGU6IChmcmFtZTogRnJhbWUpID0+IGJvb2xlYW4sIGRlc2NyaXB0aW9uID0gJycsIHRpbWVvdXQgPSAzMDAwMCkge1xuICBsZXQgZnJhbWU6IEZyYW1lIHwgdW5kZWZpbmVkO1xuICBhd2FpdCB3YWl0VW50aWwoKCkgPT4ge1xuICAgIGZyYW1lID0gcGFnZVxuICAgICAgLmZyYW1lcygpXG4gICAgICAuZmluZChmcmFtZVByZWRpY2F0ZSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSghIWZyYW1lKTtcbiAgfSwgZGVzY3JpcHRpb24sIHRpbWVvdXQsIDEwMDApO1xuXG4gIGlmICghZnJhbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZhaWxlZCB0byBmaW5kIGlmcmFtZScpO1xuICB9XG5cbiAgcmV0dXJuIGZyYW1lO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmaWxsSW5wdXQocGFnZU9yRnJhbWU6IFBhZ2UgfCBGcmFtZSwgaW5wdXRTZWxlY3Rvcjogc3RyaW5nLCBpbnB1dFZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgcGFnZU9yRnJhbWUuJGV2YWwoaW5wdXRTZWxlY3RvciwgKGlucHV0OiBFbGVtZW50KSA9PiB7XG4gICAgY29uc3QgaW5wdXRFbGVtZW50ID0gaW5wdXQ7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGlucHV0RWxlbWVudC52YWx1ZSA9ICcnO1xuICB9KTtcbiAgYXdhaXQgcGFnZU9yRnJhbWUudHlwZShpbnB1dFNlbGVjdG9yLCBpbnB1dFZhbHVlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0VmFsdWUocGFnZU9yRnJhbWU6IFBhZ2UgfCBGcmFtZSwgaW5wdXRTZWxlY3Rvcjogc3RyaW5nLCBpbnB1dFZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgcGFnZU9yRnJhbWUuJGV2YWwoaW5wdXRTZWxlY3RvciwgKGlucHV0OiBFbGVtZW50LCBpbnB1dFZhbHVlKSA9PiB7XG4gICAgY29uc3QgaW5wdXRFbGVtZW50ID0gaW5wdXQ7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGlucHV0RWxlbWVudC52YWx1ZSA9IGlucHV0VmFsdWU7XG4gIH0sIFtpbnB1dFZhbHVlXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsaWNrQnV0dG9uKHBhZ2U6IFBhZ2UgfCBGcmFtZSwgYnV0dG9uU2VsZWN0b3I6IHN0cmluZykge1xuICBhd2FpdCBwYWdlLiRldmFsKGJ1dHRvblNlbGVjdG9yLCAoZWwpID0+IChlbCBhcyBIVE1MRWxlbWVudCkuY2xpY2soKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsaWNrTGluayhwYWdlOiBQYWdlLCBhU2VsZWN0b3I6IHN0cmluZykge1xuICBhd2FpdCBwYWdlLiRldmFsKGFTZWxlY3RvciwgKGVsOiBhbnkpID0+IHtcbiAgICBpZiAoIWVsIHx8IHR5cGVvZiBlbC5jbGljayA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlbC5jbGljaygpO1xuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcGFnZUV2YWxBbGw8Uj4ocGFnZTogUGFnZSB8IEZyYW1lLCBzZWxlY3Rvcjogc3RyaW5nLFxuICBkZWZhdWx0UmVzdWx0OiBhbnksIGNhbGxiYWNrOiAoZWxlbWVudHM6IEVsZW1lbnRbXSwgLi4uYXJnczogYW55KSA9PiBSLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8Uj4ge1xuICBsZXQgcmVzdWx0ID0gZGVmYXVsdFJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBhd2FpdCBwYWdlLiQkZXZhbChzZWxlY3RvciwgY2FsbGJhY2ssIC4uLmFyZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gVE9ETyB0ZW1wb3Jhcnkgd29ya2Fyb3VuZCB0byBwdXBwZXRlZXJAMS41LjAgd2hpY2ggYnJlYWtzICQkZXZhbCBiZXZhaHZpb3IgdW50aWwgdGhleSB3aWxsIHJlbGVhc2UgYSBuZXcgdmVyc2lvbi5cbiAgICBpZiAoZS5tZXNzYWdlLmluZGV4T2YoJ0Vycm9yOiBmYWlsZWQgdG8gZmluZCBlbGVtZW50cyBtYXRjaGluZyBzZWxlY3RvcicpICE9PSAwKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHBhZ2VFdmFsPFI+KHBhZ2VPckZyYW1lOiBQYWdlIHwgRnJhbWUsIHNlbGVjdG9yOiBzdHJpbmcsXG4gIGRlZmF1bHRSZXN1bHQ6IGFueSwgY2FsbGJhY2s6IChlbGVtZW50czogRWxlbWVudCwgLi4uYXJnczogYW55KSA9PiBSLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8Uj4ge1xuICBsZXQgcmVzdWx0ID0gZGVmYXVsdFJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBhd2FpdCBwYWdlT3JGcmFtZS4kZXZhbChzZWxlY3RvciwgY2FsbGJhY2ssIC4uLmFyZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gVE9ETyB0ZW1wb3Jhcnkgd29ya2Fyb3VuZCB0byBwdXBwZXRlZXJAMS41LjAgd2hpY2ggYnJlYWtzICQkZXZhbCBiZXZhaHZpb3IgdW50aWwgdGhleSB3aWxsIHJlbGVhc2UgYSBuZXcgdmVyc2lvbi5cbiAgICBpZiAoZS5tZXNzYWdlLmluZGV4T2YoJ0Vycm9yOiBmYWlsZWQgdG8gZmluZCBlbGVtZW50cyBtYXRjaGluZyBzZWxlY3RvcicpICE9PSAwKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGVsZW1lbnRQcmVzZW50T25QYWdlKHBhZ2VPckZyYW1lOiBQYWdlIHwgRnJhbWUsIHNlbGVjdG9yOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGF3YWl0IHBhZ2VPckZyYW1lLiQoc2VsZWN0b3IpICE9PSBudWxsO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkcm9wZG93blNlbGVjdChwYWdlOiBQYWdlLCBzZWxlY3RTZWxlY3Rvcjogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gIGF3YWl0IHBhZ2Uuc2VsZWN0KHNlbGVjdFNlbGVjdG9yLCB2YWx1ZSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRyb3Bkb3duRWxlbWVudHMocGFnZTogUGFnZSwgc2VsZWN0b3I6IHN0cmluZykge1xuICBjb25zdCBvcHRpb25zID0gYXdhaXQgcGFnZS5ldmFsdWF0ZSgob3B0aW9uU2VsZWN0b3IpID0+IHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKG9wdGlvblNlbGVjdG9yKSlcbiAgICAgIC5maWx0ZXIoKG8pID0+IG8udmFsdWUpXG4gICAgICAubWFwKChvKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogby50ZXh0LFxuICAgICAgICAgIHZhbHVlOiBvLnZhbHVlLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gIH0sIGAke3NlbGVjdG9yfSA+IG9wdGlvbmApO1xuICByZXR1cm4gb3B0aW9ucztcbn1cblxuZXhwb3J0IHtcbiAgd2FpdFVudGlsRWxlbWVudEZvdW5kLFxuICB3YWl0VW50aWxFbGVtZW50RGlzYXBwZWFyLFxuICB3YWl0VW50aWxJZnJhbWVGb3VuZCxcbiAgZmlsbElucHV0LFxuICBjbGlja0J1dHRvbixcbiAgY2xpY2tMaW5rLFxuICBkcm9wZG93blNlbGVjdCxcbiAgZHJvcGRvd25FbGVtZW50cyxcbiAgcGFnZUV2YWwsXG4gIHBhZ2VFdmFsQWxsLFxuICBlbGVtZW50UHJlc2VudE9uUGFnZSxcbiAgc2V0VmFsdWUsXG59O1xuIl19