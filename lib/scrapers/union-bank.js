"use strict";

require("core-js/modules/es.symbol.description");

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.promise");

require("core-js/modules/es.string.replace");

require("core-js/modules/es.string.trim");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _moment = _interopRequireDefault(require("moment"));

var _baseScraperWithBrowser = require("./base-scraper-with-browser");

var _elementsInteractions = require("../helpers/elements-interactions");

var _navigation = require("../helpers/navigation");

var _constants = require("../constants");

var _transactions = require("../transactions");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const BASE_URL = 'https://hb.unionbank.co.il';
const TRANSACTIONS_URL = `${BASE_URL}/eBanking/Accounts/ExtendedActivity.aspx#/`;
const DATE_FORMAT = 'DD/MM/YY';
const NO_TRANSACTION_IN_DATE_RANGE_TEXT = 'לא קיימות תנועות מתאימות על פי הסינון שהוגדר';
const DATE_HEADER = 'תאריך';
const DESCRIPTION_HEADER = 'תיאור';
const REFERENCE_HEADER = 'אסמכתא';
const DEBIT_HEADER = 'חובה';
const CREDIT_HEADER = 'זכות';
const PENDING_TRANSACTIONS_TABLE_ID = 'trTodayActivityNapaTableUpper';
const COMPLETED_TRANSACTIONS_TABLE_ID = 'ctlActivityTable';
const ERROR_MESSAGE_CLASS = 'errInfo';
const ACCOUNTS_DROPDOWN_SELECTOR = 'select#ddlAccounts_m_ddl';

function getPossibleLoginResults() {
  const urls = {};
  urls[_baseScraperWithBrowser.LoginResults.Success] = [/eBanking\/Accounts/];
  urls[_baseScraperWithBrowser.LoginResults.InvalidPassword] = [/InternalSite\/CustomUpdate\/leumi\/LoginPage.ASP/];
  return urls;
}

function createLoginFields(credentials) {
  return [{
    selector: '#uid',
    value: credentials.username
  }, {
    selector: '#password',
    value: credentials.password
  }];
}

function getAmountData(amountStr) {
  const amountStrCopy = amountStr.replace(',', '');
  return parseFloat(amountStrCopy);
}

function getTxnAmount(txn) {
  const credit = getAmountData(txn.credit);
  const debit = getAmountData(txn.debit);
  return (Number.isNaN(credit) ? 0 : credit) - (Number.isNaN(debit) ? 0 : debit);
}

function convertTransactions(txns) {
  return txns.map(txn => {
    const convertedDate = (0, _moment.default)(txn.date, DATE_FORMAT).toISOString();
    const convertedAmount = getTxnAmount(txn);
    return {
      type: _transactions.TransactionTypes.Normal,
      identifier: txn.reference ? parseInt(txn.reference, 10) : undefined,
      date: convertedDate,
      processedDate: convertedDate,
      originalAmount: convertedAmount,
      originalCurrency: _constants.SHEKEL_CURRENCY,
      chargedAmount: convertedAmount,
      status: txn.status,
      description: txn.description,
      memo: txn.memo
    };
  });
}

function getTransactionDate(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[DATE_HEADER]] || '').trim();
}

function getTransactionDescription(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[DESCRIPTION_HEADER]] || '').trim();
}

function getTransactionReference(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[REFERENCE_HEADER]] || '').trim();
}

function getTransactionDebit(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[DEBIT_HEADER]] || '').trim();
}

function getTransactionCredit(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[CREDIT_HEADER]] || '').trim();
}

function extractTransactionDetails(txnRow, txnsTableHeaders, txnStatus) {
  const tds = txnRow.innerTds;
  return {
    status: txnStatus,
    date: getTransactionDate(tds, txnsTableHeaders),
    description: getTransactionDescription(tds, txnsTableHeaders),
    reference: getTransactionReference(tds, txnsTableHeaders),
    debit: getTransactionDebit(tds, txnsTableHeaders),
    credit: getTransactionCredit(tds, txnsTableHeaders),
    memo: ''
  };
}

function isExpandedDescRow(txnRow) {
  return txnRow.id === 'rowAdded';
}
/* eslint-disable no-param-reassign */


function editLastTransactionDesc(txnRow, lastTxn) {
  lastTxn.description = `${lastTxn.description} ${txnRow.innerTds[0]}`;
  return lastTxn;
}

function handleTransactionRow(txns, txnsTableHeaders, txnRow, txnType) {
  if (isExpandedDescRow(txnRow)) {
    const lastTransaction = txns.pop();

    if (lastTransaction) {
      txns.push(editLastTransactionDesc(txnRow, lastTransaction));
    } else {
      throw new Error('internal union-bank error');
    }
  } else {
    txns.push(extractTransactionDetails(txnRow, txnsTableHeaders, txnType));
  }
}

async function getTransactionsTableHeaders(page, tableTypeId) {
  const headersMap = [];
  const headersObjs = await (0, _elementsInteractions.pageEvalAll)(page, `#WorkSpaceBox #${tableTypeId} tr[class='header'] th`, null, ths => {
    return ths.map((th, index) => ({
      text: th.innerText.trim(),
      index
    }));
  });

  for (const headerObj of headersObjs) {
    headersMap[headerObj.text] = headerObj.index;
  }

  return headersMap;
}

async function extractTransactionsFromTable(page, tableTypeId, txnType) {
  const txns = [];
  const transactionsTableHeaders = await getTransactionsTableHeaders(page, tableTypeId);
  const transactionsRows = await (0, _elementsInteractions.pageEvalAll)(page, `#WorkSpaceBox #${tableTypeId} tr[class]:not([class='header'])`, [], trs => {
    return trs.map(tr => ({
      id: tr.getAttribute('id') || '',
      innerTds: Array.from(tr.getElementsByTagName('td')).map(td => td.innerText)
    }));
  });

  for (const txnRow of transactionsRows) {
    handleTransactionRow(txns, transactionsTableHeaders, txnRow, txnType);
  }

  return txns;
}

async function isNoTransactionInDateRangeError(page) {
  const hasErrorInfoElement = await (0, _elementsInteractions.elementPresentOnPage)(page, `.${ERROR_MESSAGE_CLASS}`);

  if (hasErrorInfoElement) {
    const errorText = await page.$eval(`.${ERROR_MESSAGE_CLASS}`, errorElement => {
      return errorElement.innerText;
    });
    return errorText.trim() === NO_TRANSACTION_IN_DATE_RANGE_TEXT;
  }

  return false;
}

async function chooseAccount(page, accountId) {
  const hasDropDownList = await (0, _elementsInteractions.elementPresentOnPage)(page, ACCOUNTS_DROPDOWN_SELECTOR);

  if (hasDropDownList) {
    await (0, _elementsInteractions.dropdownSelect)(page, ACCOUNTS_DROPDOWN_SELECTOR, accountId);
  }
}

async function searchByDates(page, startDate) {
  await (0, _elementsInteractions.dropdownSelect)(page, 'select#ddlTransactionPeriod', '004');
  await (0, _elementsInteractions.waitUntilElementFound)(page, 'select#ddlTransactionPeriod');
  await (0, _elementsInteractions.fillInput)(page, 'input#dtFromDate_textBox', startDate.format(DATE_FORMAT));
  await (0, _elementsInteractions.clickButton)(page, 'input#btnDisplayDates');
  await (0, _navigation.waitForNavigation)(page);
}

async function getAccountNumber(page) {
  const selectedSnifAccount = await page.$eval('#ddlAccounts_m_ddl option[selected="selected"]', option => {
    return option.innerText;
  });
  return selectedSnifAccount.replace('/', '_');
}

async function expandTransactionsTable(page) {
  const hasExpandAllButton = await (0, _elementsInteractions.elementPresentOnPage)(page, "a[id*='lnkCtlExpandAll']");

  if (hasExpandAllButton) {
    await (0, _elementsInteractions.clickButton)(page, "a[id*='lnkCtlExpandAll']");
  }
}

async function scrapeTransactionsFromTable(page) {
  const pendingTxns = await extractTransactionsFromTable(page, PENDING_TRANSACTIONS_TABLE_ID, _transactions.TransactionStatuses.Pending);
  const completedTxns = await extractTransactionsFromTable(page, COMPLETED_TRANSACTIONS_TABLE_ID, _transactions.TransactionStatuses.Completed);
  const txns = [...pendingTxns, ...completedTxns];
  return convertTransactions(txns);
}

async function getAccountTransactions(page) {
  await Promise.race([(0, _elementsInteractions.waitUntilElementFound)(page, `#${COMPLETED_TRANSACTIONS_TABLE_ID}`, false), (0, _elementsInteractions.waitUntilElementFound)(page, `.${ERROR_MESSAGE_CLASS}`, false)]);
  const noTransactionInRangeError = await isNoTransactionInDateRangeError(page);

  if (noTransactionInRangeError) {
    return [];
  }

  await expandTransactionsTable(page);
  return scrapeTransactionsFromTable(page);
}

async function fetchAccountData(page, startDate, accountId) {
  await chooseAccount(page, accountId);
  await searchByDates(page, startDate);
  const accountNumber = await getAccountNumber(page);
  const txns = await getAccountTransactions(page);
  return {
    accountNumber,
    txns
  };
}

async function fetchAccounts(page, startDate) {
  const accounts = [];
  const accountsList = await (0, _elementsInteractions.dropdownElements)(page, ACCOUNTS_DROPDOWN_SELECTOR);

  for (const account of accountsList) {
    if (account.value !== '-1') {
      // Skip "All accounts" option
      const accountData = await fetchAccountData(page, startDate, account.value);
      accounts.push(accountData);
    }
  }

  return accounts;
}

async function waitForPostLogin(page) {
  return Promise.race([(0, _elementsInteractions.waitUntilElementFound)(page, '#signoff', true), (0, _elementsInteractions.waitUntilElementFound)(page, '#restore', true)]);
}

class UnionBankScraper extends _baseScraperWithBrowser.BaseScraperWithBrowser {
  getLoginOptions(credentials) {
    return {
      loginUrl: `${BASE_URL}`,
      fields: createLoginFields(credentials),
      submitButtonSelector: '#enter',
      postAction: async () => waitForPostLogin(this.page),
      possibleResults: getPossibleLoginResults()
    };
  }

  async fetchData() {
    const defaultStartMoment = (0, _moment.default)().subtract(1, 'years').add(1, 'day');
    const startDate = this.options.startDate || defaultStartMoment.toDate();

    const startMoment = _moment.default.max(defaultStartMoment, (0, _moment.default)(startDate));

    await this.navigateTo(TRANSACTIONS_URL);
    const accounts = await fetchAccounts(this.page, startMoment);
    return {
      success: true,
      accounts
    };
  }

}

var _default = UnionBankScraper;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JhcGVycy91bmlvbi1iYW5rLnRzIl0sIm5hbWVzIjpbIkJBU0VfVVJMIiwiVFJBTlNBQ1RJT05TX1VSTCIsIkRBVEVfRk9STUFUIiwiTk9fVFJBTlNBQ1RJT05fSU5fREFURV9SQU5HRV9URVhUIiwiREFURV9IRUFERVIiLCJERVNDUklQVElPTl9IRUFERVIiLCJSRUZFUkVOQ0VfSEVBREVSIiwiREVCSVRfSEVBREVSIiwiQ1JFRElUX0hFQURFUiIsIlBFTkRJTkdfVFJBTlNBQ1RJT05TX1RBQkxFX0lEIiwiQ09NUExFVEVEX1RSQU5TQUNUSU9OU19UQUJMRV9JRCIsIkVSUk9SX01FU1NBR0VfQ0xBU1MiLCJBQ0NPVU5UU19EUk9QRE9XTl9TRUxFQ1RPUiIsImdldFBvc3NpYmxlTG9naW5SZXN1bHRzIiwidXJscyIsIkxvZ2luUmVzdWx0cyIsIlN1Y2Nlc3MiLCJJbnZhbGlkUGFzc3dvcmQiLCJjcmVhdGVMb2dpbkZpZWxkcyIsImNyZWRlbnRpYWxzIiwic2VsZWN0b3IiLCJ2YWx1ZSIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJnZXRBbW91bnREYXRhIiwiYW1vdW50U3RyIiwiYW1vdW50U3RyQ29weSIsInJlcGxhY2UiLCJwYXJzZUZsb2F0IiwiZ2V0VHhuQW1vdW50IiwidHhuIiwiY3JlZGl0IiwiZGViaXQiLCJOdW1iZXIiLCJpc05hTiIsImNvbnZlcnRUcmFuc2FjdGlvbnMiLCJ0eG5zIiwibWFwIiwiY29udmVydGVkRGF0ZSIsImRhdGUiLCJ0b0lTT1N0cmluZyIsImNvbnZlcnRlZEFtb3VudCIsInR5cGUiLCJUcmFuc2FjdGlvblR5cGVzIiwiTm9ybWFsIiwiaWRlbnRpZmllciIsInJlZmVyZW5jZSIsInBhcnNlSW50IiwidW5kZWZpbmVkIiwicHJvY2Vzc2VkRGF0ZSIsIm9yaWdpbmFsQW1vdW50Iiwib3JpZ2luYWxDdXJyZW5jeSIsIlNIRUtFTF9DVVJSRU5DWSIsImNoYXJnZWRBbW91bnQiLCJzdGF0dXMiLCJkZXNjcmlwdGlvbiIsIm1lbW8iLCJnZXRUcmFuc2FjdGlvbkRhdGUiLCJ0ZHMiLCJ0eG5zVGFibGVIZWFkZXJzIiwidHJpbSIsImdldFRyYW5zYWN0aW9uRGVzY3JpcHRpb24iLCJnZXRUcmFuc2FjdGlvblJlZmVyZW5jZSIsImdldFRyYW5zYWN0aW9uRGViaXQiLCJnZXRUcmFuc2FjdGlvbkNyZWRpdCIsImV4dHJhY3RUcmFuc2FjdGlvbkRldGFpbHMiLCJ0eG5Sb3ciLCJ0eG5TdGF0dXMiLCJpbm5lclRkcyIsImlzRXhwYW5kZWREZXNjUm93IiwiaWQiLCJlZGl0TGFzdFRyYW5zYWN0aW9uRGVzYyIsImxhc3RUeG4iLCJoYW5kbGVUcmFuc2FjdGlvblJvdyIsInR4blR5cGUiLCJsYXN0VHJhbnNhY3Rpb24iLCJwb3AiLCJwdXNoIiwiRXJyb3IiLCJnZXRUcmFuc2FjdGlvbnNUYWJsZUhlYWRlcnMiLCJwYWdlIiwidGFibGVUeXBlSWQiLCJoZWFkZXJzTWFwIiwiaGVhZGVyc09ianMiLCJ0aHMiLCJ0aCIsImluZGV4IiwidGV4dCIsImlubmVyVGV4dCIsImhlYWRlck9iaiIsImV4dHJhY3RUcmFuc2FjdGlvbnNGcm9tVGFibGUiLCJ0cmFuc2FjdGlvbnNUYWJsZUhlYWRlcnMiLCJ0cmFuc2FjdGlvbnNSb3dzIiwidHJzIiwidHIiLCJnZXRBdHRyaWJ1dGUiLCJBcnJheSIsImZyb20iLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInRkIiwiaXNOb1RyYW5zYWN0aW9uSW5EYXRlUmFuZ2VFcnJvciIsImhhc0Vycm9ySW5mb0VsZW1lbnQiLCJlcnJvclRleHQiLCIkZXZhbCIsImVycm9yRWxlbWVudCIsImNob29zZUFjY291bnQiLCJhY2NvdW50SWQiLCJoYXNEcm9wRG93bkxpc3QiLCJzZWFyY2hCeURhdGVzIiwic3RhcnREYXRlIiwiZm9ybWF0IiwiZ2V0QWNjb3VudE51bWJlciIsInNlbGVjdGVkU25pZkFjY291bnQiLCJvcHRpb24iLCJleHBhbmRUcmFuc2FjdGlvbnNUYWJsZSIsImhhc0V4cGFuZEFsbEJ1dHRvbiIsInNjcmFwZVRyYW5zYWN0aW9uc0Zyb21UYWJsZSIsInBlbmRpbmdUeG5zIiwiVHJhbnNhY3Rpb25TdGF0dXNlcyIsIlBlbmRpbmciLCJjb21wbGV0ZWRUeG5zIiwiQ29tcGxldGVkIiwiZ2V0QWNjb3VudFRyYW5zYWN0aW9ucyIsIlByb21pc2UiLCJyYWNlIiwibm9UcmFuc2FjdGlvbkluUmFuZ2VFcnJvciIsImZldGNoQWNjb3VudERhdGEiLCJhY2NvdW50TnVtYmVyIiwiZmV0Y2hBY2NvdW50cyIsImFjY291bnRzIiwiYWNjb3VudHNMaXN0IiwiYWNjb3VudCIsImFjY291bnREYXRhIiwid2FpdEZvclBvc3RMb2dpbiIsIlVuaW9uQmFua1NjcmFwZXIiLCJCYXNlU2NyYXBlcldpdGhCcm93c2VyIiwiZ2V0TG9naW5PcHRpb25zIiwibG9naW5VcmwiLCJmaWVsZHMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsInBvc3RBY3Rpb24iLCJwb3NzaWJsZVJlc3VsdHMiLCJmZXRjaERhdGEiLCJkZWZhdWx0U3RhcnRNb21lbnQiLCJzdWJ0cmFjdCIsImFkZCIsIm9wdGlvbnMiLCJ0b0RhdGUiLCJzdGFydE1vbWVudCIsIm1vbWVudCIsIm1heCIsIm5hdmlnYXRlVG8iLCJzdWNjZXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQVNBOztBQUNBOztBQUNBOzs7O0FBTUEsTUFBTUEsUUFBUSxHQUFHLDRCQUFqQjtBQUNBLE1BQU1DLGdCQUFnQixHQUFJLEdBQUVELFFBQVMsNENBQXJDO0FBQ0EsTUFBTUUsV0FBVyxHQUFHLFVBQXBCO0FBQ0EsTUFBTUMsaUNBQWlDLEdBQUcsOENBQTFDO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLE9BQXBCO0FBQ0EsTUFBTUMsa0JBQWtCLEdBQUcsT0FBM0I7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyxRQUF6QjtBQUNBLE1BQU1DLFlBQVksR0FBRyxNQUFyQjtBQUNBLE1BQU1DLGFBQWEsR0FBRyxNQUF0QjtBQUNBLE1BQU1DLDZC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LFdBQVcsR0FBR0MsZ0JBQU9DLEdBQVAsQ0FBV1Asa0JBQVgsRUFBK0IscUJBQU9sQyxTQUFQLENBQS9CLENBQXBCOztBQUVBLFVBQU0sS0FBSzBDLFVBQUwsQ0FBZ0J0SixnQkFBaEIsQ0FBTjtBQUVBLFVBQU1nSSxRQUFRLEdBQUcsTUFBTUQsYUFBYSxDQUFDLEtBQUtoRCxJQUFOLEVBQVlvRSxXQUFaLENBQXBDO0FBRUEsV0FBTztBQUNMSSxNQUFBQSxPQUFPLEVBQUUsSUFESjtBQUVMdkIsTUFBQUE7QUFGSyxLQUFQO0FBSUQ7O0FBeEJtRDs7ZUEyQnZDSyxnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb21lbnQsIHsgTW9tZW50IH0gZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IFBhZ2UgfSBmcm9tICdwdXBwZXRlZXInO1xuaW1wb3J0IHsgQmFzZVNjcmFwZXJXaXRoQnJvd3NlciwgTG9naW5SZXN1bHRzLCBQb3NzaWJsZUxvZ2luUmVzdWx0cyB9IGZyb20gJy4vYmFzZS1zY3JhcGVyLXdpdGgtYnJvd3Nlcic7XG5pbXBvcnQge1xuICBkcm9wZG93blNlbGVjdCxcbiAgZHJvcGRvd25FbGVtZW50cyxcbiAgZmlsbElucHV0LFxuICBjbGlja0J1dHRvbixcbiAgd2FpdFVudGlsRWxlbWVudEZvdW5kLFxuICBwYWdlRXZhbEFsbCxcbiAgZWxlbWVudFByZXNlbnRPblBhZ2UsXG59IGZyb20gJy4uL2hlbHBlcnMvZWxlbWVudHMtaW50ZXJhY3Rpb25zJztcbmltcG9ydCB7IHdhaXRGb3JOYXZpZ2F0aW9uIH0gZnJvbSAnLi4vaGVscGVycy9uYXZpZ2F0aW9uJztcbmltcG9ydCB7IFNIRUtFTF9DVVJSRU5DWSB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBUcmFuc2FjdGlvbnNBY2NvdW50LCBUcmFuc2FjdGlvbiwgVHJhbnNhY3Rpb25TdGF0dXNlcyxcbiAgVHJhbnNhY3Rpb25UeXBlcyxcbn0gZnJvbSAnLi4vdHJhbnNhY3Rpb25zJztcbmltcG9ydCB7IFNjcmFwZXJDcmVkZW50aWFscyB9IGZyb20gJy4vYmFzZS1zY3JhcGVyJztcblxuY29uc3QgQkFTRV9VUkwgPSAnaHR0cHM6Ly9oYi51bmlvbmJhbmsuY28uaWwnO1xuY29uc3QgVFJBTlNBQ1RJT05TX1VSTCA9IGAke0JBU0VfVVJMfS9lQmFua2luZy9BY2NvdW50cy9FeHRlbmRlZEFjdGl2aXR5LmFzcHgjL2A7XG5jb25zdCBEQVRFX0ZPUk1BVCA9ICdERC9NTS9ZWSc7XG5jb25zdCBOT19UUkFOU0FDVElPTl9JTl9EQVRFX1JBTkdFX1RFWFQgPSAn15zXkCDXp9eZ15nXnteV16og16rXoNeV16LXldeqINee16rXkNeZ157XldeqINei15wg16TXmSDXlNeh15nXoNeV158g16nXlNeV15LXk9eoJztcbmNvbnN0IERBVEVfSEVBREVSID0gJ9eq15DXqNeZ15onO1xuY29uc3QgREVTQ1JJUFRJT05fSEVBREVSID0gJ9eq15nXkNeV16gnO1xuY29uc3QgUkVGRVJFTkNFX0hFQURFUiA9ICfXkNeh157Xm9eq15AnO1xuY29uc3QgREVCSVRfSEVBREVSID0gJ9eX15XXkdeUJztcbmNvbnN0IENSRURJVF9IRUFERVIgPSAn15bXm9eV16onO1xuY29uc3QgUEVORElOR19UUkFOU0FDVElPTlNfVEFCTEVfSUQgPSAndHJUb2RheUFjdGl2aXR5TmFwYVRhYmxlVXBwZXInO1xuY29uc3QgQ09NUExFVEVEX1RSQU5TQUNUSU9OU19UQUJMRV9JRCA9ICdjdGxBY3Rpdml0eVRhYmxlJztcbmNvbnN0IEVSUk9SX01FU1NBR0VfQ0xBU1MgPSAnZXJySW5mbyc7XG5jb25zdCBBQ0NPVU5UU19EUk9QRE9XTl9TRUxFQ1RPUiA9ICdzZWxlY3QjZGRsQWNjb3VudHNfbV9kZGwnO1xuXG5mdW5jdGlvbiBnZXRQb3NzaWJsZUxvZ2luUmVzdWx0cygpIHtcbiAgY29uc3QgdXJsczogUG9zc2libGVMb2dpblJlc3VsdHMgPSB7fTtcbiAgdXJsc1tMb2dpblJlc3VsdHMuU3VjY2Vzc10gPSBbL2VCYW5raW5nXFwvQWNjb3VudHMvXTtcbiAgdXJsc1tMb2dpblJlc3VsdHMuSW52YWxpZFBhc3N3b3JkXSA9IFsvSW50ZXJuYWxTaXRlXFwvQ3VzdG9tVXBkYXRlXFwvbGV1bWlcXC9Mb2dpblBhZ2UuQVNQL107XG4gIHJldHVybiB1cmxzO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVMb2dpbkZpZWxkcyhjcmVkZW50aWFsczogU2NyYXBlckNyZWRlbnRpYWxzKSB7XG4gIHJldHVybiBbXG4gICAgeyBzZWxlY3RvcjogJyN1aWQnLCB2YWx1ZTogY3JlZGVudGlhbHMudXNlcm5hbWUgfSxcbiAgICB7IHNlbGVjdG9yOiAnI3Bhc3N3b3JkJywgdmFsdWU6IGNyZWRlbnRpYWxzLnBhc3N3b3JkIH0sXG4gIF07XG59XG5cbmZ1bmN0aW9uIGdldEFtb3VudERhdGEoYW1vdW50U3RyOiBzdHJpbmcpIHtcbiAgY29uc3QgYW1vdW50U3RyQ29weSA9IGFtb3VudFN0ci5yZXBsYWNlKCcsJywgJycpO1xuICByZXR1cm4gcGFyc2VGbG9hdChhbW91bnRTdHJDb3B5KTtcbn1cblxuaW50ZXJmYWNlIFNjcmFwZWRUcmFuc2FjdGlvbiB7XG4gIGNyZWRpdDogc3RyaW5nO1xuICBkZWJpdDogc3RyaW5nO1xuICBkYXRlOiBzdHJpbmc7XG4gIHJlZmVyZW5jZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgbWVtbzogc3RyaW5nO1xuICBzdGF0dXM6IFRyYW5zYWN0aW9uU3RhdHVzZXM7XG59XG5cbmZ1bmN0aW9uIGdldFR4bkFtb3VudCh0eG46IFNjcmFwZWRUcmFuc2FjdGlvbikge1xuICBjb25zdCBjcmVkaXQgPSBnZXRBbW91bnREYXRhKHR4bi5jcmVkaXQpO1xuICBjb25zdCBkZWJpdCA9IGdldEFtb3VudERhdGEodHhuLmRlYml0KTtcbiAgcmV0dXJuIChOdW1iZXIuaXNOYU4oY3JlZGl0KSA/IDAgOiBjcmVkaXQpIC0gKE51bWJlci5pc05hTihkZWJpdCkgPyAwIDogZGViaXQpO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0VHJhbnNhY3Rpb25zKHR4bnM6IFNjcmFwZWRUcmFuc2FjdGlvbltdKTogVHJhbnNhY3Rpb25bXSB7XG4gIHJldHVybiB0eG5zLm1hcCgodHhuKSA9PiB7XG4gICAgY29uc3QgY29udmVydGVkRGF0ZSA9IG1vbWVudCh0eG4uZGF0ZSwgREFURV9GT1JNQVQpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgY29udmVydGVkQW1vdW50ID0gZ2V0VHhuQW1vdW50KHR4bik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFRyYW5zYWN0aW9uVHlwZXMuTm9ybWFsLFxuICAgICAgaWRlbnRpZmllcjogdHhuLnJlZmVyZW5jZSA/IHBhcnNlSW50KHR4bi5yZWZlcmVuY2UsIDEwKSA6IHVuZGVmaW5lZCxcbiAgICAgIGRhdGU6IGNvbnZlcnRlZERhdGUsXG4gICAgICBwcm9jZXNzZWREYXRlOiBjb252ZXJ0ZWREYXRlLFxuICAgICAgb3JpZ2luYWxBbW91bnQ6IGNvbnZlcnRlZEFtb3VudCxcbiAgICAgIG9yaWdpbmFsQ3VycmVuY3k6IFNIRUtFTF9DVVJSRU5DWSxcbiAgICAgIGNoYXJnZWRBbW91bnQ6IGNvbnZlcnRlZEFtb3VudCxcbiAgICAgIHN0YXR1czogdHhuLnN0YXR1cyxcbiAgICAgIGRlc2NyaXB0aW9uOiB0eG4uZGVzY3JpcHRpb24sXG4gICAgICBtZW1vOiB0eG4ubWVtbyxcbiAgICB9O1xuICB9KTtcbn1cblxudHlwZSBUcmFuc2FjdGlvbnNUciA9IHsgaWQ6IHN0cmluZywgaW5uZXJUZHM6IFRyYW5zYWN0aW9uc1RyVGRzIH07XG50eXBlIFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzID0gUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbnR5cGUgVHJhbnNhY3Rpb25zVHJUZHMgPSBzdHJpbmdbXTtcblxuZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25EYXRlKHRkczogVHJhbnNhY3Rpb25zVHJUZHMsIHR4bnNUYWJsZUhlYWRlcnM6IFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzKSB7XG4gIHJldHVybiAodGRzW3R4bnNUYWJsZUhlYWRlcnNbREFURV9IRUFERVJdXSB8fCAnJykudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkRlc2NyaXB0aW9uKHRkczogVHJhbnNhY3Rpb25zVHJUZHMsIHR4bnNUYWJsZUhlYWRlcnM6IFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzKSB7XG4gIHJldHVybiAodGRzW3R4bnNUYWJsZUhlYWRlcnNbREVTQ1JJUFRJT05fSEVBREVSXV0gfHwgJycpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25SZWZlcmVuY2UodGRzOiBUcmFuc2FjdGlvbnNUclRkcywgdHhuc1RhYmxlSGVhZGVyczogVHJhbnNhY3Rpb25UYWJsZUhlYWRlcnMpIHtcbiAgcmV0dXJuICh0ZHNbdHhuc1RhYmxlSGVhZGVyc1tSRUZFUkVOQ0VfSEVBREVSXV0gfHwgJycpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25EZWJpdCh0ZHM6IFRyYW5zYWN0aW9uc1RyVGRzLCB0eG5zVGFibGVIZWFkZXJzOiBUcmFuc2FjdGlvblRhYmxlSGVhZGVycykge1xuICByZXR1cm4gKHRkc1t0eG5zVGFibGVIZWFkZXJzW0RFQklUX0hFQURFUl1dIHx8ICcnKS50cmltKCk7XG59XG5cbmZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQ3JlZGl0KHRkczogVHJhbnNhY3Rpb25zVHJUZHMsIHR4bnNUYWJsZUhlYWRlcnM6IFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzKSB7XG4gIHJldHVybiAodGRzW3R4bnNUYWJsZUhlYWRlcnNbQ1JFRElUX0hFQURFUl1dIHx8ICcnKS50cmltKCk7XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RUcmFuc2FjdGlvbkRldGFpbHModHhuUm93OiBUcmFuc2FjdGlvbnNUciwgdHhuc1RhYmxlSGVhZGVyczogVHJhbnNhY3Rpb25UYWJsZUhlYWRlcnMsIHR4blN0YXR1czogVHJhbnNhY3Rpb25TdGF0dXNlcyk6IFNjcmFwZWRUcmFuc2FjdGlvbiB7XG4gIGNvbnN0IHRkcyA9IHR4blJvdy5pbm5lclRkcztcbiAgcmV0dXJuIHtcbiAgICBzdGF0dXM6IHR4blN0YXR1cyxcbiAgICBkYXRlOiBnZXRUcmFuc2FjdGlvbkRhdGUodGRzLCB0eG5zVGFibGVIZWFkZXJzKSxcbiAgICBkZXNjcmlwdGlvbjogZ2V0VHJhbnNhY3Rpb25EZXNjcmlwdGlvbih0ZHMsIHR4bnNUYWJsZUhlYWRlcnMpLFxuICAgIHJlZmVyZW5jZTogZ2V0VHJhbnNhY3Rpb25SZWZlcmVuY2UodGRzLCB0eG5zVGFibGVIZWFkZXJzKSxcbiAgICBkZWJpdDogZ2V0VHJhbnNhY3Rpb25EZWJpdCh0ZHMsIHR4bnNUYWJsZUhlYWRlcnMpLFxuICAgIGNyZWRpdDogZ2V0VHJhbnNhY3Rpb25DcmVkaXQodGRzLCB0eG5zVGFibGVIZWFkZXJzKSxcbiAgICBtZW1vOiAnJyxcbiAgfTtcbn1cblxuZnVuY3Rpb24gaXNFeHBhbmRlZERlc2NSb3codHhuUm93OiBUcmFuc2FjdGlvbnNUcikge1xuICByZXR1cm4gdHhuUm93LmlkID09PSAncm93QWRkZWQnO1xufVxuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiAqL1xuZnVuY3Rpb24gZWRpdExhc3RUcmFuc2FjdGlvbkRlc2ModHhuUm93OiBUcmFuc2FjdGlvbnNUciwgbGFzdFR4bjogU2NyYXBlZFRyYW5zYWN0aW9uKTogU2NyYXBlZFRyYW5zYWN0aW9uIHtcbiAgbGFzdFR4bi5kZXNjcmlwdGlvbiA9IGAke2xhc3RUeG4uZGVzY3JpcHRpb259ICR7dHhuUm93LmlubmVyVGRzWzBdfWA7XG4gIHJldHVybiBsYXN0VHhuO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVUcmFuc2FjdGlvblJvdyh0eG5zOiBTY3JhcGVkVHJhbnNhY3Rpb25bXSwgdHhuc1RhYmxlSGVhZGVyczogVHJhbnNhY3Rpb25UYWJsZUhlYWRlcnMsIHR4blJvdzogVHJhbnNhY3Rpb25zVHIsIHR4blR5cGU6IFRyYW5zYWN0aW9uU3RhdHVzZXMpIHtcbiAgaWYgKGlzRXhwYW5kZWREZXNjUm93KHR4blJvdykpIHtcbiAgICBjb25zdCBsYXN0VHJhbnNhY3Rpb24gPSB0eG5zLnBvcCgpO1xuICAgIGlmIChsYXN0VHJhbnNhY3Rpb24pIHtcbiAgICAgIHR4bnMucHVzaChlZGl0TGFzdFRyYW5zYWN0aW9uRGVzYyh0eG5Sb3csIGxhc3RUcmFuc2FjdGlvbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludGVybmFsIHVuaW9uLWJhbmsgZXJyb3InKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdHhucy5wdXNoKGV4dHJhY3RUcmFuc2FjdGlvbkRldGFpbHModHhuUm93LCB0eG5zVGFibGVIZWFkZXJzLCB0eG5UeXBlKSk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25zVGFibGVIZWFkZXJzKHBhZ2U6IFBhZ2UsIHRhYmxlVHlwZUlkOiBzdHJpbmcpIHtcbiAgY29uc3QgaGVhZGVyc01hcDogUmVjb3JkPHN0cmluZywgYW55PiA9IFtdO1xuICBjb25zdCBoZWFkZXJzT2JqcyA9IGF3YWl0IHBhZ2VFdmFsQWxsKHBhZ2UsIGAjV29ya1NwYWNlQm94ICMke3RhYmxlVHlwZUlkfSB0cltjbGFzcz0naGVhZGVyJ10gdGhgLCBudWxsLCAodGhzKSA9PiB7XG4gICAgcmV0dXJuIHRocy5tYXAoKHRoLCBpbmRleCkgPT4gKHtcbiAgICAgIHRleHQ6ICh0aCBhcyBIVE1MRWxlbWVudCkuaW5uZXJUZXh0LnRyaW0oKSxcbiAgICAgIGluZGV4LFxuICAgIH0pKTtcbiAgfSk7XG5cbiAgZm9yIChjb25zdCBoZWFkZXJPYmogb2YgaGVhZGVyc09ianMpIHtcbiAgICBoZWFkZXJzTWFwW2hlYWRlck9iai50ZXh0XSA9IGhlYWRlck9iai5pbmRleDtcbiAgfVxuICByZXR1cm4gaGVhZGVyc01hcDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdFRyYW5zYWN0aW9uc0Zyb21UYWJsZShwYWdlOiBQYWdlLCB0YWJsZVR5cGVJZDogc3RyaW5nLCB0eG5UeXBlOiBUcmFuc2FjdGlvblN0YXR1c2VzKTogUHJvbWlzZTxTY3JhcGVkVHJhbnNhY3Rpb25bXT4ge1xuICBjb25zdCB0eG5zOiBTY3JhcGVkVHJhbnNhY3Rpb25bXSA9IFtdO1xuICBjb25zdCB0cmFuc2FjdGlvbnNUYWJsZUhlYWRlcnMgPSBhd2FpdCBnZXRUcmFuc2FjdGlvbnNUYWJsZUhlYWRlcnMocGFnZSwgdGFibGVUeXBlSWQpO1xuXG4gIGNvbnN0IHRyYW5zYWN0aW9uc1Jvd3MgPSBhd2FpdCBwYWdlRXZhbEFsbDxUcmFuc2FjdGlvbnNUcltdPihwYWdlLCBgI1dvcmtTcGFjZUJveCAjJHt0YWJsZVR5cGVJZH0gdHJbY2xhc3NdOm5vdChbY2xhc3M9J2hlYWRlciddKWAsIFtdLCAodHJzKSA9PiB7XG4gICAgcmV0dXJuICh0cnMgYXMgSFRNTEVsZW1lbnRbXSkubWFwKCh0cikgPT4gKHtcbiAgICAgIGlkOiAodHIpLmdldEF0dHJpYnV0ZSgnaWQnKSB8fCAnJyxcbiAgICAgIGlubmVyVGRzOiBBcnJheS5mcm9tKHRyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0ZCcpKS5tYXAoKHRkKSA9PiAodGQgYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dCksXG4gICAgfSkpO1xuICB9KTtcblxuICBmb3IgKGNvbnN0IHR4blJvdyBvZiB0cmFuc2FjdGlvbnNSb3dzKSB7XG4gICAgaGFuZGxlVHJhbnNhY3Rpb25Sb3codHhucywgdHJhbnNhY3Rpb25zVGFibGVIZWFkZXJzLCB0eG5Sb3csIHR4blR5cGUpO1xuICB9XG4gIHJldHVybiB0eG5zO1xufVxuXG5hc3luYyBmdW5jdGlvbiBpc05vVHJhbnNhY3Rpb25JbkRhdGVSYW5nZUVycm9yKHBhZ2U6IFBhZ2UpIHtcbiAgY29uc3QgaGFzRXJyb3JJbmZvRWxlbWVudCA9IGF3YWl0IGVsZW1lbnRQcmVzZW50T25QYWdlKHBhZ2UsIGAuJHtFUlJPUl9NRVNTQUdFX0NMQVNTfWApO1xuICBpZiAoaGFzRXJyb3JJbmZvRWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHBhZ2UuJGV2YWwoYC4ke0VSUk9SX01FU1NBR0VfQ0xBU1N9YCwgKGVycm9yRWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuIChlcnJvckVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dDtcbiAgICB9KTtcbiAgICByZXR1cm4gZXJyb3JUZXh0LnRyaW0oKSA9PT0gTk9fVFJBTlNBQ1RJT05fSU5fREFURV9SQU5HRV9URVhUO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY2hvb3NlQWNjb3VudChwYWdlOiBQYWdlLCBhY2NvdW50SWQ6IHN0cmluZykge1xuICBjb25zdCBoYXNEcm9wRG93bkxpc3QgPSBhd2FpdCBlbGVtZW50UHJlc2VudE9uUGFnZShwYWdlLCBBQ0NPVU5UU19EUk9QRE9XTl9TRUxFQ1RPUik7XG4gIGlmIChoYXNEcm9wRG93bkxpc3QpIHtcbiAgICBhd2FpdCBkcm9wZG93blNlbGVjdChwYWdlLCBBQ0NPVU5UU19EUk9QRE9XTl9TRUxFQ1RPUiwgYWNjb3VudElkKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hCeURhdGVzKHBhZ2U6IFBhZ2UsIHN0YXJ0RGF0ZTogTW9tZW50KSB7XG4gIGF3YWl0IGRyb3Bkb3duU2VsZWN0KHBhZ2UsICdzZWxlY3QjZGRsVHJhbnNhY3Rpb25QZXJpb2QnLCAnMDA0Jyk7XG4gIGF3YWl0IHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlLCAnc2VsZWN0I2RkbFRyYW5zYWN0aW9uUGVyaW9kJyk7XG4gIGF3YWl0IGZpbGxJbnB1dChcbiAgICBwYWdlLFxuICAgICdpbnB1dCNkdEZyb21EYXRlX3RleHRCb3gnLFxuICAgIHN0YXJ0RGF0ZS5mb3JtYXQoREFURV9GT1JNQVQpLFxuICApO1xuICBhd2FpdCBjbGlja0J1dHRvbihwYWdlLCAnaW5wdXQjYnRuRGlzcGxheURhdGVzJyk7XG4gIGF3YWl0IHdhaXRGb3JOYXZpZ2F0aW9uKHBhZ2UpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY2NvdW50TnVtYmVyKHBhZ2U6IFBhZ2UpIHtcbiAgY29uc3Qgc2VsZWN0ZWRTbmlmQWNjb3VudCA9IGF3YWl0IHBhZ2UuJGV2YWwoJyNkZGxBY2NvdW50c19tX2RkbCBvcHRpb25bc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiXScsIChvcHRpb24pID0+IHtcbiAgICByZXR1cm4gKG9wdGlvbiBhcyBIVE1MRWxlbWVudCkuaW5uZXJUZXh0O1xuICB9KTtcblxuICByZXR1cm4gc2VsZWN0ZWRTbmlmQWNjb3VudC5yZXBsYWNlKCcvJywgJ18nKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXhwYW5kVHJhbnNhY3Rpb25zVGFibGUocGFnZTogUGFnZSkge1xuICBjb25zdCBoYXNFeHBhbmRBbGxCdXR0b24gPSBhd2FpdCBlbGVtZW50UHJlc2VudE9uUGFnZShwYWdlLCBcImFbaWQqPSdsbmtDdGxFeHBhbmRBbGwnXVwiKTtcbiAgaWYgKGhhc0V4cGFuZEFsbEJ1dHRvbikge1xuICAgIGF3YWl0IGNsaWNrQnV0dG9uKHBhZ2UsIFwiYVtpZCo9J2xua0N0bEV4cGFuZEFsbCddXCIpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNjcmFwZVRyYW5zYWN0aW9uc0Zyb21UYWJsZShwYWdlOiBQYWdlKTogUHJvbWlzZTxUcmFuc2FjdGlvbltdPiB7XG4gIGNvbnN0IHBlbmRpbmdUeG5zID0gYXdhaXQgZXh0cmFjdFRyYW5zYWN0aW9uc0Zyb21UYWJsZShwYWdlLCBQRU5ESU5HX1RSQU5TQUNUSU9OU19UQUJMRV9JRCxcbiAgICBUcmFuc2FjdGlvblN0YXR1c2VzLlBlbmRpbmcpO1xuICBjb25zdCBjb21wbGV0ZWRUeG5zID0gYXdhaXQgZXh0cmFjdFRyYW5zYWN0aW9uc0Zyb21UYWJsZShwYWdlLCBDT01QTEVURURfVFJBTlNBQ1RJT05TX1RBQkxFX0lELFxuICAgIFRyYW5zYWN0aW9uU3RhdHVzZXMuQ29tcGxldGVkKTtcbiAgY29uc3QgdHhucyA9IFtcbiAgICAuLi5wZW5kaW5nVHhucyxcbiAgICAuLi5jb21wbGV0ZWRUeG5zLFxuICBdO1xuICByZXR1cm4gY29udmVydFRyYW5zYWN0aW9ucyh0eG5zKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjb3VudFRyYW5zYWN0aW9ucyhwYWdlOiBQYWdlKTogUHJvbWlzZTxUcmFuc2FjdGlvbltdPiB7XG4gIGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgd2FpdFVudGlsRWxlbWVudEZvdW5kKHBhZ2UsIGAjJHtDT01QTEVURURfVFJBTlNBQ1RJT05TX1RBQkxFX0lEfWAsIGZhbHNlKSxcbiAgICB3YWl0VW50aWxFbGVtZW50Rm91bmQocGFnZSwgYC4ke0VSUk9SX01FU1NBR0VfQ0xBU1N9YCwgZmFsc2UpLFxuICBdKTtcblxuICBjb25zdCBub1RyYW5zYWN0aW9uSW5SYW5nZUVycm9yID0gYXdhaXQgaXNOb1RyYW5zYWN0aW9uSW5EYXRlUmFuZ2VFcnJvcihwYWdlKTtcbiAgaWYgKG5vVHJhbnNhY3Rpb25JblJhbmdlRXJyb3IpIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBhd2FpdCBleHBhbmRUcmFuc2FjdGlvbnNUYWJsZShwYWdlKTtcbiAgcmV0dXJuIHNjcmFwZVRyYW5zYWN0aW9uc0Zyb21UYWJsZShwYWdlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hBY2NvdW50RGF0YShwYWdlOiBQYWdlLCBzdGFydERhdGU6IE1vbWVudCwgYWNjb3VudElkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zYWN0aW9uc0FjY291bnQ+IHtcbiAgYXdhaXQgY2hvb3NlQWNjb3VudChwYWdlLCBhY2NvdW50SWQpO1xuICBhd2FpdCBzZWFyY2hCeURhdGVzKHBhZ2UsIHN0YXJ0RGF0ZSk7XG4gIGNvbnN0IGFjY291bnROdW1iZXIgPSBhd2FpdCBnZXRBY2NvdW50TnVtYmVyKHBhZ2UpO1xuICBjb25zdCB0eG5zID0gYXdhaXQgZ2V0QWNjb3VudFRyYW5zYWN0aW9ucyhwYWdlKTtcbiAgcmV0dXJuIHtcbiAgICBhY2NvdW50TnVtYmVyLFxuICAgIHR4bnMsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQWNjb3VudHMocGFnZTogUGFnZSwgc3RhcnREYXRlOiBNb21lbnQpIHtcbiAgY29uc3QgYWNjb3VudHM6IFRyYW5zYWN0aW9uc0FjY291bnRbXSA9IFtdO1xuICBjb25zdCBhY2NvdW50c0xpc3QgPSBhd2FpdCBkcm9wZG93bkVsZW1lbnRzKHBhZ2UsIEFDQ09VTlRTX0RST1BET1dOX1NFTEVDVE9SKTtcbiAgZm9yIChjb25zdCBhY2NvdW50IG9mIGFjY291bnRzTGlzdCkge1xuICAgIGlmIChhY2NvdW50LnZhbHVlICE9PSAnLTEnKSB7IC8vIFNraXAgXCJBbGwgYWNjb3VudHNcIiBvcHRpb25cbiAgICAgIGNvbnN0IGFjY291bnREYXRhID0gYXdhaXQgZmV0Y2hBY2NvdW50RGF0YShwYWdlLCBzdGFydERhdGUsIGFjY291bnQudmFsdWUpO1xuICAgICAgYWNjb3VudHMucHVzaChhY2NvdW50RGF0YSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhY2NvdW50cztcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2FpdEZvclBvc3RMb2dpbihwYWdlOiBQYWdlKSB7XG4gIHJldHVybiBQcm9taXNlLnJhY2UoW1xuICAgIHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlLCAnI3NpZ25vZmYnLCB0cnVlKSxcbiAgICB3YWl0VW50aWxFbGVtZW50Rm91bmQocGFnZSwgJyNyZXN0b3JlJywgdHJ1ZSksXG4gIF0pO1xufVxuXG5jbGFzcyBVbmlvbkJhbmtTY3JhcGVyIGV4dGVuZHMgQmFzZVNjcmFwZXJXaXRoQnJvd3NlciB7XG4gIGdldExvZ2luT3B0aW9ucyhjcmVkZW50aWFsczogU2NyYXBlckNyZWRlbnRpYWxzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvZ2luVXJsOiBgJHtCQVNFX1VSTH1gLFxuICAgICAgZmllbGRzOiBjcmVhdGVMb2dpbkZpZWxkcyhjcmVkZW50aWFscyksXG4gICAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJyNlbnRlcicsXG4gICAgICBwb3N0QWN0aW9uOiBhc3luYyAoKSA9PiB3YWl0Rm9yUG9zdExvZ2luKHRoaXMucGFnZSksXG4gICAgICBwb3NzaWJsZVJlc3VsdHM6IGdldFBvc3NpYmxlTG9naW5SZXN1bHRzKCksXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGZldGNoRGF0YSgpIHtcbiAgICBjb25zdCBkZWZhdWx0U3RhcnRNb21lbnQgPSBtb21lbnQoKS5zdWJ0cmFjdCgxLCAneWVhcnMnKS5hZGQoMSwgJ2RheScpO1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHRoaXMub3B0aW9ucy5zdGFydERhdGUgfHwgZGVmYXVsdFN0YXJ0TW9tZW50LnRvRGF0ZSgpO1xuICAgIGNvbnN0IHN0YXJ0TW9tZW50ID0gbW9tZW50Lm1heChkZWZhdWx0U3RhcnRNb21lbnQsIG1vbWVudChzdGFydERhdGUpKTtcblxuICAgIGF3YWl0IHRoaXMubmF2aWdhdGVUbyhUUkFOU0FDVElPTlNfVVJMKTtcblxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgZmV0Y2hBY2NvdW50cyh0aGlzLnBhZ2UsIHN0YXJ0TW9tZW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgYWNjb3VudHMsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBVbmlvbkJhbmtTY3JhcGVyO1xuIl19