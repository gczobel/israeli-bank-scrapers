"use strict";

require("core-js/modules/es.symbol.description");

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.promise");

require("core-js/modules/es.string.replace");

require("core-js/modules/es.string.trim");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _moment = _interopRequireDefault(require("moment"));

var _baseScraperWithBrowser = require("./base-scraper-with-browser");

var _elementsInteractions = require("../helpers/elements-interactions");

var _navigation = require("../helpers/navigation");

var _constants = require("../constants");

var _transactions = require("../transactions");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const BASE_URL = 'https://hb2.bankleumi.co.il';
const DATE_FORMAT = 'DD/MM/YY';
const NO_TRANSACTION_IN_DATE_RANGE_TEXT = 'לא קיימות תנועות מתאימות על פי הסינון שהוגדר';
const ACCOUNT_BLOCKED_MSG = 'המנוי חסום';

function getTransactionsUrl() {
  return `${BASE_URL}/ebanking/Accounts/ExtendedActivity.aspx?WidgetPar=1#/`;
}

function getPossibleLoginResults() {
  const urls = {};
  urls[_baseScraperWithBrowser.LoginResults.Success] = [/ebanking\/SO\/SPA.aspx/i];
  urls[_baseScraperWithBrowser.LoginResults.InvalidPassword] = [/InternalSite\/CustomUpdate\/leumi\/LoginPage.ASP/];
  urls[_baseScraperWithBrowser.LoginResults.AccountBlocked] = [async options => {
    if (!options || !options.page) {
      throw new Error('missing page options argument');
    }

    const errorMessage = await (0, _elementsInteractions.pageEvalAll)(options.page, '.errHeader', [], label => {
      return label[0].innerText;
    });
    return errorMessage.startsWith(ACCOUNT_BLOCKED_MSG);
  }]; // urls[LOGIN_RESULT.CHANGE_PASSWORD] = ``; // TODO should wait until my password expires

  return urls;
}

function createLoginFields(credentials) {
  return [{
    selector: '#wtr_uid',
    value: credentials.username
  }, {
    selector: '#wtr_password',
    value: credentials.password
  }];
}

function getAmountData(amountStr) {
  const amountStrCopy = amountStr.replace(',', '');
  const amount = parseFloat(amountStrCopy);
  const currency = _constants.SHEKEL_CURRENCY;
  return {
    amount,
    currency
  };
}

function convertTransactions(txns) {
  return txns.map(txn => {
    const txnDate = (0, _moment.default)(txn.date, DATE_FORMAT).toISOString();
    const credit = getAmountData(txn.credit || '').amount;
    const debit = getAmountData(txn.debit || '').amount;
    const amount = (Number.isNaN(credit) ? 0 : credit) - (Number.isNaN(debit) ? 0 : debit);
    const transaction = {
      type: _transactions.TransactionTypes.Normal,
      identifier: txn.reference ? parseInt(txn.reference, 10) : undefined,
      date: txnDate,
      processedDate: txnDate,
      originalAmount: amount,
      originalCurrency: _constants.SHEKEL_CURRENCY,
      chargedAmount: amount,
      status: txn.status,
      description: txn.description || '',
      memo: txn.memo || ''
    };
    return transaction;
  });
}

async function extractCompletedTransactionsFromPage(page) {
  const txns = [];
  const tdsValues = await (0, _elementsInteractions.pageEvalAll)(page, '#WorkSpaceBox #ctlActivityTable tr td', [], tds => {
    return tds.map(td => ({
      classList: td.getAttribute('class') || '',
      innerText: td.innerText
    }));
  });

  for (const element of tdsValues) {
    if (element.classList.includes('ExtendedActivityColumnDate')) {
      const newTransaction = {
        status: _transactions.TransactionStatuses.Completed
      };
      newTransaction.date = (element.innerText || '').trim();
      txns.push(newTransaction);
    } else {
      const changedTransaction = txns.length ? txns.pop() : null;

      if (changedTransaction) {
        if (element.classList.includes('ActivityTableColumn1LTR') || element.classList.includes('ActivityTableColumn1')) {
          changedTransaction.description = element.innerText;
        } else if (element.classList.includes('ReferenceNumberUniqeClass')) {
          changedTransaction.reference = element.innerText;
        } else if (element.classList.includes('AmountDebitUniqeClass')) {
          changedTransaction.debit = element.innerText;
        } else if (element.classList.includes('AmountCreditUniqeClass')) {
          changedTransaction.credit = element.innerText;
        } else if (element.classList.includes('number_column')) {
          changedTransaction.balance = element.innerText;
        } else if (element.classList.includes('tdDepositRowAdded')) {
          changedTransaction.memo = (element.innerText || '').trim();
        }

        txns.push(changedTransaction);
      }
    }
  }

  return txns;
}

async function extractPendingTransactionsFromPage(page) {
  const txns = [];
  const tdsValues = await (0, _elementsInteractions.pageEvalAll)(page, '#WorkSpaceBox table#ctlTodayActivityTableUpper tr td', [], tds => {
    return tds.map(td => ({
      classList: td.getAttribute('class') || '',
      innerText: td.innerText
    }));
  });

  for (const element of tdsValues) {
    if (element.classList.includes('Colume1Width')) {
      const newTransaction = {
        status: _transactions.TransactionStatuses.Pending
      };
      newTransaction.date = (element.innerText || '').trim();
      txns.push(newTransaction);
    } else {
      const changedTransaction = txns.length ? txns.pop() : null;

      if (changedTransaction) {
        if (element.classList.includes('Colume2Width')) {
          changedTransaction.description = element.innerText;
        } else if (element.classList.includes('Colume3Width')) {
          changedTransaction.reference = element.innerText;
        } else if (element.classList.includes('Colume4Width')) {
          changedTransaction.debit = element.innerText;
        } else if (element.classList.includes('Colume5Width')) {
          changedTransaction.credit = element.innerText;
        } else if (element.classList.includes('Colume6Width')) {
          changedTransaction.balance = element.innerText;
        }

        txns.push(changedTransaction);
      }
    }
  }

  return txns;
}

async function isNoTransactionInDateRangeError(page) {
  const hasErrorInfoElement = await (0, _elementsInteractions.elementPresentOnPage)(page, '.errInfo');

  if (hasErrorInfoElement) {
    const errorText = await page.$eval('.errInfo', errorElement => {
      return errorElement.innerText;
    });
    return errorText === NO_TRANSACTION_IN_DATE_RANGE_TEXT;
  }

  return false;
}

async function fetchTransactionsForAccount(page, startDate, accountId) {
  await (0, _elementsInteractions.dropdownSelect)(page, 'select#ddlAccounts_m_ddl', accountId);
  await (0, _elementsInteractions.dropdownSelect)(page, 'select#ddlTransactionPeriod', '004');
  await (0, _elementsInteractions.waitUntilElementFound)(page, 'select#ddlTransactionPeriod');
  await (0, _elementsInteractions.fillInput)(page, 'input#dtFromDate_textBox', startDate.format(DATE_FORMAT));
  await (0, _elementsInteractions.clickButton)(page, 'input#btnDisplayDates');
  await (0, _navigation.waitForNavigation)(page);
  const selectedSnifAccount = await page.$eval('#ddlAccounts_m_ddl option[selected="selected"]', option => {
    return option.innerText;
  });
  const accountNumber = selectedSnifAccount.replace('/', '_');
  const balanceValue = await page.$eval('#lblBalancesVal', element => element.textContent);
  const balance = balanceValue ? parseFloat(balanceValue.replace(/[^\d.]/g, '')) : undefined;
  await Promise.race([(0, _elementsInteractions.waitUntilElementFound)(page, 'table#WorkSpaceBox table#ctlActivityTable', false), (0, _elementsInteractions.waitUntilElementFound)(page, '.errInfo', false)]);

  if (await isNoTransactionInDateRangeError(page)) {
    return {
      accountNumber,
      balance,
      txns: []
    };
  }

  const hasExpandAllButton = await (0, _elementsInteractions.elementPresentOnPage)(page, 'a#lnkCtlExpandAllInPage');

  if (hasExpandAllButton) {
    await (0, _elementsInteractions.clickButton)(page, 'a#lnkCtlExpandAllInPage');
  }

  const pendingTxns = await extractPendingTransactionsFromPage(page);
  const completedTxns = await extractCompletedTransactionsFromPage(page);
  const txns = [...pendingTxns, ...completedTxns];
  return {
    accountNumber,
    txns: convertTransactions(txns)
  };
}

async function fetchTransactions(page, startDate) {
  const res = []; // Loop through all available accounts and collect transactions from all

  const accounts = await (0, _elementsInteractions.dropdownElements)(page, 'select#ddlAccounts_m_ddl');

  for (const account of accounts) {
    // Skip "All accounts" option
    if (account.value !== '-1') {
      res.push((await fetchTransactionsForAccount(page, startDate, account.value)));
    }
  }

  return res;
}

async function waitForPostLogin(page) {
  // TODO check for condition to provide new password
  await Promise.race([(0, _elementsInteractions.waitUntilElementFound)(page, 'div.leumi-container', true), (0, _elementsInteractions.waitUntilElementFound)(page, '#BodyContent_ctl00_loginErrMsg', true), (0, _elementsInteractions.waitUntilElementFound)(page, '.ErrMsg', true)]);
}

class LeumiScraper extends _baseScraperWithBrowser.BaseScraperWithBrowser {
  getLoginOptions(credentials) {
    return {
      loginUrl: `${BASE_URL}`,
      fields: createLoginFields(credentials),
      submitButtonSelector: '#enter',
      postAction: async () => waitForPostLogin(this.page),
      possibleResults: getPossibleLoginResults()
    };
  }

  async fetchData() {
    const defaultStartMoment = (0, _moment.default)().subtract(1, 'years').add(1, 'day');
    const startDate = this.options.startDate || defaultStartMoment.toDate();

    const startMoment = _moment.default.max(defaultStartMoment, (0, _moment.default)(startDate));

    const url = getTransactionsUrl();
    await this.navigateTo(url);
    const accounts = await fetchTransactions(this.page, startMoment);
    return {
      success: true,
      accounts
    };
  }

}

var _default = LeumiScraper;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JhcGVycy9sZXVtaS50cyJdLCJuYW1lcyI6WyJCQVNFX1VSTCIsIkRBVEVfRk9STUFUIiwiTk9fVFJBTlNBQ1RJT05fSU5fREFURV9SQU5HRV9URVhUIiwiQUNDT1VOVF9CTE9DS0VEX01TRyIsImdldFRyYW5zYWN0aW9uc1VybCIsImdldFBvc3NpYmxlTG9naW5SZXN1bHRzIiwidXJscyIsIkxvZ2luUmVzdWx0cyIsIlN1Y2Nlc3MiLCJJbnZhbGlkUGFzc3dvcmQiLCJBY2NvdW50QmxvY2tlZCIsIm9wdGlvbnMiLCJwYWdlIiwiRXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJsYWJlbCIsImlubmVyVGV4dCIsInN0YXJ0c1dpdGgiLCJjcmVhdGVMb2dpbkZpZWxkcyIsImNyZWRlbnRpYWxzIiwic2VsZWN0b3IiLCJ2YWx1ZSIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJnZXRBbW91bnREYXRhIiwiYW1vdW50U3RyIiwiYW1vdW50U3RyQ29weSIsInJlcGxhY2UiLCJhbW91bnQiLCJwYXJzZUZsb2F0IiwiY3VycmVuY3kiLCJTSEVLRUxfQ1VSUkVOQ1kiLCJjb252ZXJ0VHJhbnNhY3Rpb25zIiwidHhucyIsIm1hcCIsInR4biIsInR4bkRhdGUiLCJkYXRlIiwidG9JU09TdHJpbmciLCJjcmVkaXQiLCJkZWJpdCIsIk51bWJlciIsImlzTmFOIiwidHJhbnNhY3Rpb24iLCJ0eXBlIiwiVHJhbnNhY3Rpb25UeXBlcyIsIk5vcm1hbCIsImlkZW50aWZpZXIiLCJyZWZlcmVuY2UiLCJwYXJzZUludCIsInVuZGVmaW5lZCIsInByb2Nlc3NlZERhdGUiLCJvcmlnaW5hbEFtb3VudCIsIm9yaWdpbmFsQ3VycmVuY3kiLCJjaGFyZ2VkQW1vdW50Iiwic3RhdHVzIiwiZGVzY3JpcHRpb24iLCJtZW1vIiwiZXh0cmFjdENvbXBsZXRlZFRyYW5zYWN0aW9uc0Zyb21QYWdlIiwidGRzVmFsdWVzIiwidGRzIiwidGQiLCJjbGFzc0xpc3QiLCJnZXRBdHRyaWJ1dGUiLCJlbGVtZW50IiwiaW5jbHVkZXMiLCJuZXdUcmFuc2FjdGlvbiIsIlRyYW5zYWN0aW9uU3RhdHVzZXMiLCJDb21wbGV0ZWQiLCJ0cmltIiwicHVzaCIsImNoYW5nZWRUcmFuc2FjdGlvbiIsImxlbmd0aCIsInBvcCIsImJhbGFuY2UiLCJleHRyYWN0UGVuZGluZ1RyYW5zYWN0aW9uc0Zyb21QYWdlIiwiUGVuZGluZyIsImlzTm9UcmFuc2FjdGlvbkluRGF0ZVJhbmdlRXJyb3IiLCJoYXNFcnJvckluZm9FbGVtZW50IiwiZXJyb3JUZXh0IiwiJGV2YWwiLCJlcnJvckVsZW1lbnQiLCJmZXRjaFRyYW5zYWN0aW9uc0ZvckFjY291bnQiLCJzdGFydERhdGUiLCJhY2NvdW50SWQiLCJmb3JtYXQiLCJzZWxlY3RlZFNuaWZBY2NvdW50Iiwib3B0aW9uIiwiYWNjb3VudE51bWJlciIsImJhbGFuY2VWYWx1ZSIsInRleHRDb250ZW50IiwiUHJvbWlzZSIsInJhY2UiLCJoYXNFeHBhbmRBbGxCdXR0b24iLCJwZW5kaW5nVHhucyIsImNvbXBsZXRlZFR4bnMiLCJmZXRjaFRyYW5zYWN0aW9ucyIsInJlcyIsImFjY291bnRzIiwiYWNjb3VudCIsIndhaXRGb3JQb3N0TG9naW4iLCJMZXVtaVNjcmFwZXIiLCJCYXNlU2NyYXBlcldpdGhCcm93c2VyIiwiZ2V0TG9naW5PcHRpb25zIiwibG9naW5VcmwiLCJmaWVsZHMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsInBvc3RBY3Rpb24iLCJwb3NzaWJsZVJlc3VsdHMiLCJmZXRjaERhdGEiLCJkZWZhdWx0U3RhcnRNb21lbnQiLCJzdWJ0cmFjdCIsImFkZCIsInRvRGF0ZSIsInN0YXJ0TW9tZW50IiwibW9tZW50IiwibWF4IiwidXJsIiwibmF2aWdhdGVUbyIsInN1Y2Nlc3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBU0E7O0FBQ0E7O0FBQ0E7Ozs7QUFLQSxNQUFNQSxRQUFRLEdBQUcsNkJBQWpCO0FBQ0EsTUFB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QyxVQUFNQyxrQkFBa0IsR0FBRyx1QkFBU0MsUUFBVCxDQUFrQixDQUFsQixFQUFxQixPQUFyQixFQUE4QkMsR0FBOUIsQ0FBa0MsQ0FBbEMsRUFBcUMsS0FBckMsQ0FBM0I7QUFDQSxVQUFNN0IsU0FBUyxHQUFHLEtBQUt4RSxPQUFMLENBQWF3RSxTQUFiLElBQTBCMkIsa0JBQWtCLENBQUNHLE1BQW5CLEVBQTVDOztBQUNBLFVBQU1DLFdBQVcsR0FBR0MsZ0JBQU9DLEdBQVAsQ0FBV04sa0JBQVgsRUFBK0IscUJBQU8zQixTQUFQLENBQS9CLENBQXBCOztBQUVBLFVBQU1rQyxHQUFHLEdBQUdqSCxrQkFBa0IsRUFBOUI7QUFDQSxVQUFNLEtBQUtrSCxVQUFMLENBQWdCRCxHQUFoQixDQUFOO0FBRUEsVUFBTW5CLFFBQVEsR0FBRyxNQUFNRixpQkFBaUIsQ0FBQyxLQUFLcEYsSUFBTixFQUFZc0csV0FBWixDQUF4QztBQUVBLFdBQU87QUFDTEssTUFBQUEsT0FBTyxFQUFFLElBREo7QUFFTHJCLE1BQUFBO0FBRkssS0FBUDtBQUlEOztBQXpCK0M7O2VBNEJuQ0csWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb21lbnQsIHsgTW9tZW50IH0gZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IFBhZ2UgfSBmcm9tICdwdXBwZXRlZXInO1xuaW1wb3J0IHsgQmFzZVNjcmFwZXJXaXRoQnJvd3NlciwgTG9naW5SZXN1bHRzLCBMb2dpbk9wdGlvbnMgfSBmcm9tICcuL2Jhc2Utc2NyYXBlci13aXRoLWJyb3dzZXInO1xuaW1wb3J0IHtcbiAgZHJvcGRvd25TZWxlY3QsXG4gIGRyb3Bkb3duRWxlbWVudHMsXG4gIGZpbGxJbnB1dCxcbiAgY2xpY2tCdXR0b24sXG4gIHdhaXRVbnRpbEVsZW1lbnRGb3VuZCxcbiAgcGFnZUV2YWxBbGwsXG4gIGVsZW1lbnRQcmVzZW50T25QYWdlLFxufSBmcm9tICcuLi9oZWxwZXJzL2VsZW1lbnRzLWludGVyYWN0aW9ucyc7XG5pbXBvcnQgeyB3YWl0Rm9yTmF2aWdhdGlvbiB9IGZyb20gJy4uL2hlbHBlcnMvbmF2aWdhdGlvbic7XG5pbXBvcnQgeyBTSEVLRUxfQ1VSUkVOQ1kgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgVHJhbnNhY3Rpb25zQWNjb3VudCwgVHJhbnNhY3Rpb24sIFRyYW5zYWN0aW9uU3RhdHVzZXMsIFRyYW5zYWN0aW9uVHlwZXMsXG59IGZyb20gJy4uL3RyYW5zYWN0aW9ucyc7XG5pbXBvcnQgeyBTY2FwZXJTY3JhcGluZ1Jlc3VsdCwgU2NyYXBlckNyZWRlbnRpYWxzIH0gZnJvbSAnLi9iYXNlLXNjcmFwZXInO1xuXG5jb25zdCBCQVNFX1VSTCA9ICdodHRwczovL2hiMi5iYW5rbGV1bWkuY28uaWwnO1xuY29uc3QgREFURV9GT1JNQVQgPSAnREQvTU0vWVknO1xuY29uc3QgTk9fVFJBTlNBQ1RJT05fSU5fREFURV9SQU5HRV9URVhUID0gJ9ec15Ag16fXmdeZ157XldeqINeq16DXldei15XXqiDXnteq15DXmdee15XXqiDXotecINek15kg15TXodeZ16DXldefINep15TXldeS15PXqCc7XG5jb25zdCBBQ0NPVU5UX0JMT0NLRURfTVNHID0gJ9eU157XoNeV15kg15fXodeV150nO1xuXG5mdW5jdGlvbiBnZXRUcmFuc2FjdGlvbnNVcmwoKSB7XG4gIHJldHVybiBgJHtCQVNFX1VSTH0vZWJhbmtpbmcvQWNjb3VudHMvRXh0ZW5kZWRBY3Rpdml0eS5hc3B4P1dpZGdldFBhcj0xIy9gO1xufVxuXG5mdW5jdGlvbiBnZXRQb3NzaWJsZUxvZ2luUmVzdWx0cygpIHtcbiAgY29uc3QgdXJsczogTG9naW5PcHRpb25zWydwb3NzaWJsZVJlc3VsdHMnXSA9IHt9O1xuICB1cmxzW0xvZ2luUmVzdWx0cy5TdWNjZXNzXSA9IFsvZWJhbmtpbmdcXC9TT1xcL1NQQS5hc3B4L2ldO1xuICB1cmxzW0xvZ2luUmVzdWx0cy5JbnZhbGlkUGFzc3dvcmRdID0gWy9JbnRlcm5hbFNpdGVcXC9DdXN0b21VcGRhdGVcXC9sZXVtaVxcL0xvZ2luUGFnZS5BU1AvXTtcbiAgdXJsc1tMb2dpblJlc3VsdHMuQWNjb3VudEJsb2NrZWRdID0gW2FzeW5jIChvcHRpb25zKSA9PiB7XG4gICAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLnBhZ2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWlzc2luZyBwYWdlIG9wdGlvbnMgYXJndW1lbnQnKTtcbiAgICB9XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYXdhaXQgcGFnZUV2YWxBbGwob3B0aW9ucy5wYWdlLCAnLmVyckhlYWRlcicsIFtdLCAobGFiZWwpID0+IHtcbiAgICAgIHJldHVybiAobGFiZWxbMF0gYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dDtcbiAgICB9KTtcblxuICAgIHJldHVybiBlcnJvck1lc3NhZ2Uuc3RhcnRzV2l0aChBQ0NPVU5UX0JMT0NLRURfTVNHKTtcbiAgfV07XG4gIC8vIHVybHNbTE9HSU5fUkVTVUxULkNIQU5HRV9QQVNTV09SRF0gPSBgYDsgLy8gVE9ETyBzaG91bGQgd2FpdCB1bnRpbCBteSBwYXNzd29yZCBleHBpcmVzXG4gIHJldHVybiB1cmxzO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVMb2dpbkZpZWxkcyhjcmVkZW50aWFsczogU2NyYXBlckNyZWRlbnRpYWxzKSB7XG4gIHJldHVybiBbXG4gICAgeyBzZWxlY3RvcjogJyN3dHJfdWlkJywgdmFsdWU6IGNyZWRlbnRpYWxzLnVzZXJuYW1lIH0sXG4gICAgeyBzZWxlY3RvcjogJyN3dHJfcGFzc3dvcmQnLCB2YWx1ZTogY3JlZGVudGlhbHMucGFzc3dvcmQgfSxcbiAgXTtcbn1cblxuZnVuY3Rpb24gZ2V0QW1vdW50RGF0YShhbW91bnRTdHI6IHN0cmluZykge1xuICBjb25zdCBhbW91bnRTdHJDb3B5ID0gYW1vdW50U3RyLnJlcGxhY2UoJywnLCAnJyk7XG4gIGNvbnN0IGFtb3VudCA9IHBhcnNlRmxvYXQoYW1vdW50U3RyQ29weSk7XG4gIGNvbnN0IGN1cnJlbmN5ID0gU0hFS0VMX0NVUlJFTkNZO1xuXG4gIHJldHVybiB7XG4gICAgYW1vdW50LFxuICAgIGN1cnJlbmN5LFxuICB9O1xufVxuXG5pbnRlcmZhY2UgU2NyYXBlZFRyYW5zYWN0aW9uIHtcbiAgc3RhdHVzOiBUcmFuc2FjdGlvblN0YXR1c2VzO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgbWVtbz86IHN0cmluZztcbiAgYmFsYW5jZT86IHN0cmluZztcbiAgY3JlZGl0Pzogc3RyaW5nO1xuICBkZWJpdD86IHN0cmluZztcbiAgcmVmZXJlbmNlPzogc3RyaW5nO1xuICBkYXRlPzogc3RyaW5nO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0VHJhbnNhY3Rpb25zKHR4bnM6IFNjcmFwZWRUcmFuc2FjdGlvbltdKTogVHJhbnNhY3Rpb25bXSB7XG4gIHJldHVybiB0eG5zLm1hcCgodHhuKSA9PiB7XG4gICAgY29uc3QgdHhuRGF0ZSA9IG1vbWVudCh0eG4uZGF0ZSwgREFURV9GT1JNQVQpLnRvSVNPU3RyaW5nKCk7XG5cbiAgICBjb25zdCBjcmVkaXQgPSBnZXRBbW91bnREYXRhKHR4bi5jcmVkaXQgfHwgJycpLmFtb3VudDtcbiAgICBjb25zdCBkZWJpdCA9IGdldEFtb3VudERhdGEodHhuLmRlYml0IHx8ICcnKS5hbW91bnQ7XG4gICAgY29uc3QgYW1vdW50ID0gKE51bWJlci5pc05hTihjcmVkaXQpID8gMCA6IGNyZWRpdCkgLSAoTnVtYmVyLmlzTmFOKGRlYml0KSA/IDAgOiBkZWJpdCk7XG5cbiAgICBjb25zdCB0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24gPSB7XG4gICAgICB0eXBlOiBUcmFuc2FjdGlvblR5cGVzLk5vcm1hbCxcbiAgICAgIGlkZW50aWZpZXI6IHR4bi5yZWZlcmVuY2UgPyBwYXJzZUludCh0eG4ucmVmZXJlbmNlLCAxMCkgOiB1bmRlZmluZWQsXG4gICAgICBkYXRlOiB0eG5EYXRlLFxuICAgICAgcHJvY2Vzc2VkRGF0ZTogdHhuRGF0ZSxcbiAgICAgIG9yaWdpbmFsQW1vdW50OiBhbW91bnQsXG4gICAgICBvcmlnaW5hbEN1cnJlbmN5OiBTSEVLRUxfQ1VSUkVOQ1ksXG4gICAgICBjaGFyZ2VkQW1vdW50OiBhbW91bnQsXG4gICAgICBzdGF0dXM6IHR4bi5zdGF0dXMsXG4gICAgICBkZXNjcmlwdGlvbjogdHhuLmRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgbWVtbzogdHhuLm1lbW8gfHwgJycsXG4gICAgfTtcbiAgICByZXR1cm4gdHJhbnNhY3Rpb247XG4gIH0pO1xufVxuaW50ZXJmYWNlIFNjcmFwZWRUZHMge1xuICBjbGFzc0xpc3Q6IHN0cmluZztcbiAgaW5uZXJUZXh0OiBzdHJpbmc7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RDb21wbGV0ZWRUcmFuc2FjdGlvbnNGcm9tUGFnZShwYWdlOiBQYWdlKTogUHJvbWlzZTxTY3JhcGVkVHJhbnNhY3Rpb25bXT4ge1xuICBjb25zdCB0eG5zOiBTY3JhcGVkVHJhbnNhY3Rpb25bXSA9IFtdO1xuICBjb25zdCB0ZHNWYWx1ZXMgPSBhd2FpdCBwYWdlRXZhbEFsbDxTY3JhcGVkVGRzW10+KHBhZ2UsICcjV29ya1NwYWNlQm94ICNjdGxBY3Rpdml0eVRhYmxlIHRyIHRkJywgW10sICh0ZHMpID0+IHtcbiAgICByZXR1cm4gdGRzLm1hcCgodGQpID0+ICh7XG4gICAgICBjbGFzc0xpc3Q6IHRkLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSB8fCAnJyxcbiAgICAgIGlubmVyVGV4dDogKHRkIGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHQsXG4gICAgfSkpO1xuICB9KTtcblxuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgdGRzVmFsdWVzKSB7XG4gICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmluY2x1ZGVzKCdFeHRlbmRlZEFjdGl2aXR5Q29sdW1uRGF0ZScpKSB7XG4gICAgICBjb25zdCBuZXdUcmFuc2FjdGlvbjogU2NyYXBlZFRyYW5zYWN0aW9uID0geyBzdGF0dXM6IFRyYW5zYWN0aW9uU3RhdHVzZXMuQ29tcGxldGVkIH07XG4gICAgICBuZXdUcmFuc2FjdGlvbi5kYXRlID0gKGVsZW1lbnQuaW5uZXJUZXh0IHx8ICcnKS50cmltKCk7XG4gICAgICB0eG5zLnB1c2gobmV3VHJhbnNhY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjaGFuZ2VkVHJhbnNhY3Rpb24gPSB0eG5zLmxlbmd0aCA/IHR4bnMucG9wKCkgOiBudWxsO1xuICAgICAgaWYgKGNoYW5nZWRUcmFuc2FjdGlvbikge1xuICAgICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ0FjdGl2aXR5VGFibGVDb2x1bW4xTFRSJykgfHwgZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ0FjdGl2aXR5VGFibGVDb2x1bW4xJykpIHtcbiAgICAgICAgICBjaGFuZ2VkVHJhbnNhY3Rpb24uZGVzY3JpcHRpb24gPSBlbGVtZW50LmlubmVyVGV4dDtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmNsYXNzTGlzdC5pbmNsdWRlcygnUmVmZXJlbmNlTnVtYmVyVW5pcWVDbGFzcycpKSB7XG4gICAgICAgICAgY2hhbmdlZFRyYW5zYWN0aW9uLnJlZmVyZW5jZSA9IGVsZW1lbnQuaW5uZXJUZXh0O1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmluY2x1ZGVzKCdBbW91bnREZWJpdFVuaXFlQ2xhc3MnKSkge1xuICAgICAgICAgIGNoYW5nZWRUcmFuc2FjdGlvbi5kZWJpdCA9IGVsZW1lbnQuaW5uZXJUZXh0O1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmluY2x1ZGVzKCdBbW91bnRDcmVkaXRVbmlxZUNsYXNzJykpIHtcbiAgICAgICAgICBjaGFuZ2VkVHJhbnNhY3Rpb24uY3JlZGl0ID0gZWxlbWVudC5pbm5lclRleHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ251bWJlcl9jb2x1bW4nKSkge1xuICAgICAgICAgIGNoYW5nZWRUcmFuc2FjdGlvbi5iYWxhbmNlID0gZWxlbWVudC5pbm5lclRleHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ3RkRGVwb3NpdFJvd0FkZGVkJykpIHtcbiAgICAgICAgICBjaGFuZ2VkVHJhbnNhY3Rpb24ubWVtbyA9IChlbGVtZW50LmlubmVyVGV4dCB8fCAnJykudHJpbSgpO1xuICAgICAgICB9XG4gICAgICAgIHR4bnMucHVzaChjaGFuZ2VkVHJhbnNhY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0eG5zO1xufVxuXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0UGVuZGluZ1RyYW5zYWN0aW9uc0Zyb21QYWdlKHBhZ2U6IFBhZ2UpOiBQcm9taXNlPFNjcmFwZWRUcmFuc2FjdGlvbltdPiB7XG4gIGNvbnN0IHR4bnM6IFNjcmFwZWRUcmFuc2FjdGlvbltdID0gW107XG4gIGNvbnN0IHRkc1ZhbHVlcyA9IGF3YWl0IHBhZ2VFdmFsQWxsPFNjcmFwZWRUZHNbXT4ocGFnZSwgJyNXb3JrU3BhY2VCb3ggdGFibGUjY3RsVG9kYXlBY3Rpdml0eVRhYmxlVXBwZXIgdHIgdGQnLCBbXSwgKHRkcykgPT4ge1xuICAgIHJldHVybiB0ZHMubWFwKCh0ZCkgPT4gKHtcbiAgICAgIGNsYXNzTGlzdDogdGQuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnLFxuICAgICAgaW5uZXJUZXh0OiAodGQgYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dCxcbiAgICB9KSk7XG4gIH0pO1xuXG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiB0ZHNWYWx1ZXMpIHtcbiAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ0NvbHVtZTFXaWR0aCcpKSB7XG4gICAgICBjb25zdCBuZXdUcmFuc2FjdGlvbjogU2NyYXBlZFRyYW5zYWN0aW9uID0geyBzdGF0dXM6IFRyYW5zYWN0aW9uU3RhdHVzZXMuUGVuZGluZyB9O1xuICAgICAgbmV3VHJhbnNhY3Rpb24uZGF0ZSA9IChlbGVtZW50LmlubmVyVGV4dCB8fCAnJykudHJpbSgpO1xuICAgICAgdHhucy5wdXNoKG5ld1RyYW5zYWN0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY2hhbmdlZFRyYW5zYWN0aW9uID0gdHhucy5sZW5ndGggPyB0eG5zLnBvcCgpIDogbnVsbDtcblxuICAgICAgaWYgKGNoYW5nZWRUcmFuc2FjdGlvbikge1xuICAgICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ0NvbHVtZTJXaWR0aCcpKSB7XG4gICAgICAgICAgY2hhbmdlZFRyYW5zYWN0aW9uLmRlc2NyaXB0aW9uID0gZWxlbWVudC5pbm5lclRleHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jbGFzc0xpc3QuaW5jbHVkZXMoJ0NvbHVtZTNXaWR0aCcpKSB7XG4gICAgICAgICAgY2hhbmdlZFRyYW5zYWN0aW9uLnJlZmVyZW5jZSA9IGVsZW1lbnQuaW5uZXJUZXh0O1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmluY2x1ZGVzKCdDb2x1bWU0V2lkdGgnKSkge1xuICAgICAgICAgIGNoYW5nZWRUcmFuc2FjdGlvbi5kZWJpdCA9IGVsZW1lbnQuaW5uZXJUZXh0O1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmluY2x1ZGVzKCdDb2x1bWU1V2lkdGgnKSkge1xuICAgICAgICAgIGNoYW5nZWRUcmFuc2FjdGlvbi5jcmVkaXQgPSBlbGVtZW50LmlubmVyVGV4dDtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmNsYXNzTGlzdC5pbmNsdWRlcygnQ29sdW1lNldpZHRoJykpIHtcbiAgICAgICAgICBjaGFuZ2VkVHJhbnNhY3Rpb24uYmFsYW5jZSA9IGVsZW1lbnQuaW5uZXJUZXh0O1xuICAgICAgICB9XG4gICAgICAgIHR4bnMucHVzaChjaGFuZ2VkVHJhbnNhY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0eG5zO1xufVxuXG5hc3luYyBmdW5jdGlvbiBpc05vVHJhbnNhY3Rpb25JbkRhdGVSYW5nZUVycm9yKHBhZ2U6IFBhZ2UpIHtcbiAgY29uc3QgaGFzRXJyb3JJbmZvRWxlbWVudCA9IGF3YWl0IGVsZW1lbnRQcmVzZW50T25QYWdlKHBhZ2UsICcuZXJySW5mbycpO1xuICBpZiAoaGFzRXJyb3JJbmZvRWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHBhZ2UuJGV2YWwoJy5lcnJJbmZvJywgKGVycm9yRWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuIChlcnJvckVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dDtcbiAgICB9KTtcbiAgICByZXR1cm4gZXJyb3JUZXh0ID09PSBOT19UUkFOU0FDVElPTl9JTl9EQVRFX1JBTkdFX1RFWFQ7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFRyYW5zYWN0aW9uc0ZvckFjY291bnQocGFnZTogUGFnZSwgc3RhcnREYXRlOiBNb21lbnQsIGFjY291bnRJZDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2FjdGlvbnNBY2NvdW50PiB7XG4gIGF3YWl0IGRyb3Bkb3duU2VsZWN0KHBhZ2UsICdzZWxlY3QjZGRsQWNjb3VudHNfbV9kZGwnLCBhY2NvdW50SWQpO1xuICBhd2FpdCBkcm9wZG93blNlbGVjdChwYWdlLCAnc2VsZWN0I2RkbFRyYW5zYWN0aW9uUGVyaW9kJywgJzAwNCcpO1xuICBhd2FpdCB3YWl0VW50aWxFbGVtZW50Rm91bmQocGFnZSwgJ3NlbGVjdCNkZGxUcmFuc2FjdGlvblBlcmlvZCcpO1xuICBhd2FpdCBmaWxsSW5wdXQoXG4gICAgcGFnZSxcbiAgICAnaW5wdXQjZHRGcm9tRGF0ZV90ZXh0Qm94JyxcbiAgICBzdGFydERhdGUuZm9ybWF0KERBVEVfRk9STUFUKSxcbiAgKTtcbiAgYXdhaXQgY2xpY2tCdXR0b24ocGFnZSwgJ2lucHV0I2J0bkRpc3BsYXlEYXRlcycpO1xuICBhd2FpdCB3YWl0Rm9yTmF2aWdhdGlvbihwYWdlKTtcblxuICBjb25zdCBzZWxlY3RlZFNuaWZBY2NvdW50ID0gYXdhaXQgcGFnZS4kZXZhbCgnI2RkbEFjY291bnRzX21fZGRsIG9wdGlvbltzZWxlY3RlZD1cInNlbGVjdGVkXCJdJywgKG9wdGlvbikgPT4ge1xuICAgIHJldHVybiAob3B0aW9uIGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHQ7XG4gIH0pO1xuXG4gIGNvbnN0IGFjY291bnROdW1iZXIgPSBzZWxlY3RlZFNuaWZBY2NvdW50LnJlcGxhY2UoJy8nLCAnXycpO1xuXG4gIGNvbnN0IGJhbGFuY2VWYWx1ZSA9IGF3YWl0IHBhZ2UuJGV2YWwoJyNsYmxCYWxhbmNlc1ZhbCcsIChlbGVtZW50KSA9PiBlbGVtZW50LnRleHRDb250ZW50KTtcbiAgY29uc3QgYmFsYW5jZSA9IGJhbGFuY2VWYWx1ZSA/IHBhcnNlRmxvYXQoYmFsYW5jZVZhbHVlLnJlcGxhY2UoL1teXFxkLl0vZywgJycpKSA6IHVuZGVmaW5lZDtcblxuICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgIHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlLCAndGFibGUjV29ya1NwYWNlQm94IHRhYmxlI2N0bEFjdGl2aXR5VGFibGUnLCBmYWxzZSksXG4gICAgd2FpdFVudGlsRWxlbWVudEZvdW5kKHBhZ2UsICcuZXJySW5mbycsIGZhbHNlKSxcbiAgXSk7XG5cbiAgaWYgKGF3YWl0IGlzTm9UcmFuc2FjdGlvbkluRGF0ZVJhbmdlRXJyb3IocGFnZSkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWNjb3VudE51bWJlcixcbiAgICAgIGJhbGFuY2UsXG4gICAgICB0eG5zOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgaGFzRXhwYW5kQWxsQnV0dG9uID0gYXdhaXQgZWxlbWVudFByZXNlbnRPblBhZ2UocGFnZSwgJ2EjbG5rQ3RsRXhwYW5kQWxsSW5QYWdlJyk7XG5cbiAgaWYgKGhhc0V4cGFuZEFsbEJ1dHRvbikge1xuICAgIGF3YWl0IGNsaWNrQnV0dG9uKHBhZ2UsICdhI2xua0N0bEV4cGFuZEFsbEluUGFnZScpO1xuICB9XG5cbiAgY29uc3QgcGVuZGluZ1R4bnMgPSBhd2FpdCBleHRyYWN0UGVuZGluZ1RyYW5zYWN0aW9uc0Zyb21QYWdlKHBhZ2UpO1xuICBjb25zdCBjb21wbGV0ZWRUeG5zID0gYXdhaXQgZXh0cmFjdENvbXBsZXRlZFRyYW5zYWN0aW9uc0Zyb21QYWdlKHBhZ2UpO1xuICBjb25zdCB0eG5zID0gW1xuICAgIC4uLnBlbmRpbmdUeG5zLFxuICAgIC4uLmNvbXBsZXRlZFR4bnMsXG4gIF07XG5cbiAgcmV0dXJuIHtcbiAgICBhY2NvdW50TnVtYmVyLFxuICAgIHR4bnM6IGNvbnZlcnRUcmFuc2FjdGlvbnModHhucyksXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoVHJhbnNhY3Rpb25zKHBhZ2U6IFBhZ2UsIHN0YXJ0RGF0ZTogTW9tZW50KSB7XG4gIGNvbnN0IHJlczogVHJhbnNhY3Rpb25zQWNjb3VudFtdID0gW107XG4gIC8vIExvb3AgdGhyb3VnaCBhbGwgYXZhaWxhYmxlIGFjY291bnRzIGFuZCBjb2xsZWN0IHRyYW5zYWN0aW9ucyBmcm9tIGFsbFxuICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGRyb3Bkb3duRWxlbWVudHMocGFnZSwgJ3NlbGVjdCNkZGxBY2NvdW50c19tX2RkbCcpO1xuICBmb3IgKGNvbnN0IGFjY291bnQgb2YgYWNjb3VudHMpIHtcbiAgICAvLyBTa2lwIFwiQWxsIGFjY291bnRzXCIgb3B0aW9uXG4gICAgaWYgKGFjY291bnQudmFsdWUgIT09ICctMScpIHtcbiAgICAgIHJlcy5wdXNoKGF3YWl0IGZldGNoVHJhbnNhY3Rpb25zRm9yQWNjb3VudChwYWdlLCBzdGFydERhdGUsIGFjY291bnQudmFsdWUpKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlcztcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2FpdEZvclBvc3RMb2dpbihwYWdlOiBQYWdlKTogUHJvbWlzZTx2b2lkPiB7XG4gIC8vIFRPRE8gY2hlY2sgZm9yIGNvbmRpdGlvbiB0byBwcm92aWRlIG5ldyBwYXNzd29yZFxuICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgIHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlLCAnZGl2LmxldW1pLWNvbnRhaW5lcicsIHRydWUpLFxuICAgIHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlLCAnI0JvZHlDb250ZW50X2N0bDAwX2xvZ2luRXJyTXNnJywgdHJ1ZSksXG4gICAgd2FpdFVudGlsRWxlbWVudEZvdW5kKHBhZ2UsICcuRXJyTXNnJywgdHJ1ZSksXG4gIF0pO1xufVxuXG5jbGFzcyBMZXVtaVNjcmFwZXIgZXh0ZW5kcyBCYXNlU2NyYXBlcldpdGhCcm93c2VyIHtcbiAgZ2V0TG9naW5PcHRpb25zKGNyZWRlbnRpYWxzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvZ2luVXJsOiBgJHtCQVNFX1VSTH1gLFxuICAgICAgZmllbGRzOiBjcmVhdGVMb2dpbkZpZWxkcyhjcmVkZW50aWFscyksXG4gICAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJyNlbnRlcicsXG4gICAgICBwb3N0QWN0aW9uOiBhc3luYyAoKSA9PiB3YWl0Rm9yUG9zdExvZ2luKHRoaXMucGFnZSksXG4gICAgICBwb3NzaWJsZVJlc3VsdHM6IGdldFBvc3NpYmxlTG9naW5SZXN1bHRzKCksXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGZldGNoRGF0YSgpOiBQcm9taXNlPFNjYXBlclNjcmFwaW5nUmVzdWx0PiB7XG4gICAgY29uc3QgZGVmYXVsdFN0YXJ0TW9tZW50ID0gbW9tZW50KCkuc3VidHJhY3QoMSwgJ3llYXJzJykuYWRkKDEsICdkYXknKTtcbiAgICBjb25zdCBzdGFydERhdGUgPSB0aGlzLm9wdGlvbnMuc3RhcnREYXRlIHx8IGRlZmF1bHRTdGFydE1vbWVudC50b0RhdGUoKTtcbiAgICBjb25zdCBzdGFydE1vbWVudCA9IG1vbWVudC5tYXgoZGVmYXVsdFN0YXJ0TW9tZW50LCBtb21lbnQoc3RhcnREYXRlKSk7XG5cbiAgICBjb25zdCB1cmwgPSBnZXRUcmFuc2FjdGlvbnNVcmwoKTtcbiAgICBhd2FpdCB0aGlzLm5hdmlnYXRlVG8odXJsKTtcblxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgZmV0Y2hUcmFuc2FjdGlvbnModGhpcy5wYWdlLCBzdGFydE1vbWVudCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGFjY291bnRzLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTGV1bWlTY3JhcGVyO1xuIl19